

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>HydroDB.hydro_db &mdash; Nemoh2HDB  documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> Nemoh2HDB
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../Source/Tutorials.html">Tutorial</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Source/Source_code_doc.html">Source code documentation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Nemoh2HDB</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>HydroDB.hydro_db</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for HydroDB.hydro_db</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1">#  -*- coding: utf-8 -*-</span>
<span class="c1"># ==========================================================================</span>
<span class="c1"># FRyDoM - frydom-ce.org</span>
<span class="c1"># </span>
<span class="c1"># Copyright (c) Ecole Centrale de Nantes (LHEEA lab.) and D-ICE Engineering.</span>
<span class="c1"># All rights reserved.</span>
<span class="c1"># </span>
<span class="c1"># Use of this source code is governed by a GPLv3 license that can be found</span>
<span class="c1"># in the LICENSE file of FRyDoM.</span>
<span class="c1"># </span>
<span class="c1"># ==========================================================================</span>

<span class="sd">&quot;&quot;&quot;Module to load hydrodynamic BEM data from Nemoh code&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="k">import</span> <span class="n">degrees</span><span class="p">,</span> <span class="n">radians</span><span class="p">,</span> <span class="n">pi</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="k">import</span> <span class="n">deepcopy</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="k">import</span> <span class="n">interpolate</span>

<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># from meshmagick.mmio import load_MAR</span>
<span class="c1"># from meshmagick.mesh import Mesh, Plane</span>


<span class="c1"># TODO: creer un module pour la lecture des donnees Nemoh a part du module gerant les classe relatives a l&#39;hydro du premier ordre...</span>

<span class="c1"># TODO: mettre les exceptions dans un module a part</span>

<span class="n">inf</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>  <span class="c1"># Definition of infinity for depth</span>


<span class="c1"># TODO: creer une classe HydroBodyMapper qui remplace la liste bodies et qui gere le mapping entre</span>
<span class="c1">#  les corps et les donnees de la base de donnees hydro. A un index de corps + un index de force ou</span>
<span class="c1">#  de mouvement correspond respectivement un index de ligne ou de colonne dans la base de donnees</span>
<span class="c1">#  hydro.</span>
<span class="k">class</span> <span class="nc">_FreqDB</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class _FreqDB for dealing with hydrodynamic databases.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor of the _FreqDB class.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_min_frequency</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_max_frequency</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nb_frequencies</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_iwcut</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">min_frequency</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;This subroutine gives the minimum wave frequency.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            Minimum wave frequency.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_min_frequency</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">max_frequency</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;This subroutine gives the maximum wave frequency.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            Maximum wave frequency.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iwcut</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_frequency</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">omega</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nb_frequencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;This subroutine gives the number of wave frequencies.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            Number of wave frequencies.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">omega</span><span class="p">)</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">omega</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c1"># TODO: integrer le _icut</span>
        <span class="sd">&quot;&quot;&quot;Frequency array of BEM computations in rad/s</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.ndarray</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_full_omega</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iwcut</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">w</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">w</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">_iwcut</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">get_full_omega</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_min_frequency</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_frequency</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nb_frequencies</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">wcut</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;This subroutine gives the cutting wave frequency.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            Cutting wave frequency.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iwcut</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_full_omega</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">w</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_iwcut</span><span class="p">]</span>
        
    <span class="nd">@wcut</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">wcut</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wcut</span><span class="p">):</span>  <span class="c1"># TODO: finir l&#39;implementation</span>

        <span class="sd">&quot;&quot;&quot;This subroutine sets the cutting wave frequency.</span>

<span class="sd">        Parameter</span>
<span class="sd">        ----------</span>
<span class="sd">        wcut : float</span>
<span class="sd">            Cutting wave frequency.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">wcut</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_iwcut</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_min_frequency</span> <span class="o">&lt;</span> <span class="n">wcut</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_frequency</span>
            <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_full_omega</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_iwcut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">w</span> <span class="o">&gt;=</span> <span class="n">wcut</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># TODO: a verifier</span>
    
    <span class="k">def</span> <span class="nf">set_frequencies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wmin</span><span class="p">,</span> <span class="n">wmax</span><span class="p">,</span> <span class="n">nw</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;This subroutine sets the minimum and maximum frequencies and the number of frequencies.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        wmin : float</span>
<span class="sd">            Minimum frequency.</span>
<span class="sd">        wmax : float</span>
<span class="sd">            Maximum frequency.</span>
<span class="sd">        nw : int</span>
<span class="sd">            Number of frequencies.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">assert</span> <span class="mf">0.</span> <span class="o">&lt;</span> <span class="n">wmin</span> <span class="o">&lt;</span> <span class="n">wmax</span>
        <span class="k">assert</span> <span class="n">nw</span> <span class="o">&gt;</span> <span class="mi">0</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_min_frequency</span> <span class="o">=</span> <span class="n">wmin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_max_frequency</span> <span class="o">=</span> <span class="n">wmax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nb_frequencies</span> <span class="o">=</span> <span class="n">nw</span>
    
    <span class="k">def</span> <span class="nf">get_frequency_discretization</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c1"># FIXME: BUG tres probable avec wcut !!!</span>

        <span class="sd">&quot;&quot;&quot;This subroutine gives the minimum and maximum frequencies and the number of frequencies.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        omega : float</span>
<span class="sd">            Frequency (rad/s) at which we want to get the maximum edge length.</span>
<span class="sd">        n : int, optional</span>
<span class="sd">            Minimal number of faces by wave length. Default is 10.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            Minimum frequency.</span>
<span class="sd">        float</span>
<span class="sd">            Maximum frequency.</span>
<span class="sd">        int</span>
<span class="sd">            Number of frequencies.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_min_frequency</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_frequency</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nb_frequencies</span>
    

<div class="viewcode-block" id="HydroDB"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.HydroDB">[docs]</a><span class="k">class</span> <span class="nc">HydroDB</span><span class="p">(</span><span class="n">_FreqDB</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;class to store frequency dependent hydrodynamics data coming from BEM codes in frequency domain.</span>
<span class="sd">    </span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    rho_water : float</span>
<span class="sd">        density of water (kg/m**3). Default is 1000 kg/m**3</span>
<span class="sd">    grav : float</span>
<span class="sd">        acceleration of the gravity field. Default is 9.81 m/s**2</span>
<span class="sd">    depth : float</span>
<span class="sd">        local water depth in m. Default is inf, meaning an infinite water depth.</span>
<span class="sd">    x_wave_measure : float</span>
<span class="sd">        x position of the wave probe used for wave elevation</span>
<span class="sd">    y_wave_measure : float</span>
<span class="sd">        y position of the wave probe used for wave elevation</span>
<span class="sd">    nb_wave_dir : int</span>
<span class="sd">        Number of wave directions used in computations</span>
<span class="sd">    min_wave_dir : float</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">HydroDB</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        
        <span class="c1"># General parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rho_water</span> <span class="o">=</span> <span class="mf">1000.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grav</span> <span class="o">=</span> <span class="mf">9.81</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="n">inf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_wave_measure</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_wave_measure</span> <span class="o">=</span> <span class="mf">0.</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">nb_wave_dir</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># TODO: mettre dans diffraction uniquement</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_wave_dir</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_wave_dir</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wave_dirs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">has_kochin</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># TODO: mettre dans Kochin uniquement</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nb_dir_kochin</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_dir_kochin</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_dir_kochin</span> <span class="o">=</span> <span class="mf">0.</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">body_mapper</span> <span class="o">=</span> <span class="n">HydroBodySetMapping</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_radiation_db</span> <span class="o">=</span> <span class="n">RadiationDB</span><span class="p">()</span>  <span class="c1"># IRF est genere a partir de radiation...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_diffraction_db</span> <span class="o">=</span> <span class="n">DiffractionDB</span><span class="p">()</span>  <span class="c1"># TODO: les frequences seront ajoutees lors d&#39;une requete sur la ppte !</span>

        
        <span class="bp">self</span><span class="o">.</span><span class="n">_has_froude_krylov</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_froude_krylov_db</span> <span class="o">=</span> <span class="n">FroudeKrylovDB</span><span class="p">()</span>
        
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nb_bem_problems</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c1"># TODO: methode de HydroDB</span>
        <span class="sd">&quot;&quot;&quot;Total number of problems solved during the BEM computations</span>

<span class="sd">        It is nw * (ntheta + nradiation)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_frequencies</span>
        <span class="n">ntheta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_wave_dir</span>
        <span class="k">return</span> <span class="n">nw</span> <span class="o">*</span> <span class="p">(</span><span class="n">ntheta</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_mapper</span><span class="o">.</span><span class="n">nb_motion_modes</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">radiation_db</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c1"># TODO: renseigner les frequences et wcut...</span>

        <span class="sd">&quot;&quot;&quot;This subroutine gives the radiation (added mass and damping) coefficients.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        RadiationDB</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">db</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_radiation_db</span><span class="p">)</span>
        <span class="n">db</span><span class="o">.</span><span class="n">set_frequencies</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_min_frequency</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_frequency</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nb_frequencies</span><span class="p">)</span>
        <span class="n">db</span><span class="o">.</span><span class="n">wcut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wcut</span>
        <span class="n">db</span><span class="o">.</span><span class="n">body_mapper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_mapper</span>
        <span class="k">return</span> <span class="n">db</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">diffraction_db</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c1"># TODO: renseigner les frequences et wcut...</span>

        <span class="sd">&quot;&quot;&quot;This subroutine gives the diffraction loads.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        DiffractionDB</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">db</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_diffraction_db</span><span class="p">)</span>
        <span class="n">db</span><span class="o">.</span><span class="n">set_frequencies</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_min_frequency</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_frequency</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nb_frequencies</span><span class="p">)</span>
        <span class="n">db</span><span class="o">.</span><span class="n">set_wave_dir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_wave_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_wave_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_wave_dir</span><span class="p">)</span>
        <span class="n">db</span><span class="o">.</span><span class="n">wcut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wcut</span>
        <span class="n">db</span><span class="o">.</span><span class="n">body_mapper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_mapper</span>
        <span class="n">db</span><span class="o">.</span><span class="n">_x_wave_measure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_wave_measure</span>
        <span class="n">db</span><span class="o">.</span><span class="n">_y_wave_measure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_wave_measure</span>
        <span class="k">return</span> <span class="n">db</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">froude_krylov_db</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This subroutine gives and computes the Froude-Krylov loads.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        FroudeKrylovDB</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_froude_krylov_db</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_froude_krylov</span><span class="p">:</span>
            <span class="n">db</span><span class="o">.</span><span class="n">set_frequencies</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_min_frequency</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_frequency</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nb_frequencies</span><span class="p">)</span>
            <span class="n">db</span><span class="o">.</span><span class="n">set_wave_dir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_wave_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_wave_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_wave_dir</span><span class="p">)</span>
            <span class="n">db</span><span class="o">.</span><span class="n">wcut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wcut</span>
            <span class="n">db</span><span class="o">.</span><span class="n">body_mapper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_mapper</span>

            <span class="c1"># Computation of the Froude-Krylov loads.</span>
            <span class="n">db</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho_water</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grav</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_wave_measure</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_wave_measure</span><span class="p">)</span>

            <span class="n">db</span><span class="o">.</span><span class="n">_x_wave_measure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_wave_measure</span>
            <span class="n">db</span><span class="o">.</span><span class="n">_y_wave_measure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_wave_measure</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_froude_krylov_db</span> <span class="o">=</span> <span class="n">db</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_has_froude_krylov</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="n">db</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">wave_excitation_db</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;This subroutine gives and computes the excitation loads.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        WaveExcitationDB</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">diffraction_db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">diffraction_db</span>
        <span class="n">froude_krylov_db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">froude_krylov_db</span>

        <span class="n">db</span> <span class="o">=</span> <span class="n">WaveExcitationDB</span><span class="p">()</span>
        <span class="n">db</span><span class="o">.</span><span class="n">set_frequencies</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_min_frequency</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_frequency</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nb_frequencies</span><span class="p">)</span>
        <span class="n">db</span><span class="o">.</span><span class="n">set_wave_dir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_wave_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_wave_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_wave_dir</span><span class="p">)</span>
        <span class="n">db</span><span class="o">.</span><span class="n">wcut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wcut</span>
        <span class="n">db</span><span class="o">.</span><span class="n">body_mapper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_mapper</span>

        <span class="n">db</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">diffraction_db</span><span class="o">.</span><span class="n">data</span> <span class="o">+</span> <span class="n">froude_krylov_db</span><span class="o">.</span><span class="n">data</span>  <span class="c1"># Summing diffraction and Froude-Krylov contributions.</span>

        <span class="n">db</span><span class="o">.</span><span class="n">_x_wave_measure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_wave_measure</span>
        <span class="n">db</span><span class="o">.</span><span class="n">_y_wave_measure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_wave_measure</span>

        <span class="k">return</span> <span class="n">db</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">wave_dirs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This subroutine gives the wave directions.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Array of floats</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wave_dirs</span>

<div class="viewcode-block" id="HydroDB.set_wave_direction"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.HydroDB.set_wave_direction">[docs]</a>    <span class="k">def</span> <span class="nf">set_wave_direction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_wave_dir</span><span class="p">,</span> <span class="n">max_wave_dir</span><span class="p">,</span> <span class="n">nb_wave_dir</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;This subroutine sets the wave directions.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        min_wave_dir : float</span>
<span class="sd">            Minimum wave direction.</span>
<span class="sd">        max_wave_dir : float</span>
<span class="sd">            Maximum wave direction.</span>
<span class="sd">        nb_wave_dir : int</span>
<span class="sd">            Wave direction angular step.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># self._diffraction_db.set_wave_dir(min_wave_dir, max_wave_dir, nb_wave_dir)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_wave_dir</span> <span class="o">=</span> <span class="n">min_wave_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_wave_dir</span> <span class="o">=</span> <span class="n">max_wave_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nb_wave_dir</span> <span class="o">=</span> <span class="n">nb_wave_dir</span></div>

<div class="viewcode-block" id="HydroDB.set_diffraction_data"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.HydroDB.set_diffraction_data">[docs]</a>    <span class="k">def</span> <span class="nf">set_diffraction_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;This subroutine sets the diffraction loads.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : Array of floats</span>
<span class="sd">            Diffraction loads.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># TODO: faire verif !!</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_diffraction_db</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span></div>

<div class="viewcode-block" id="HydroDB.set_radiation_data"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.HydroDB.set_radiation_data">[docs]</a>    <span class="k">def</span> <span class="nf">set_radiation_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">radiation_damping</span><span class="p">,</span> <span class="n">added_mass</span><span class="p">,</span> <span class="n">infinite_added_mass</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;This subroutine sets the radiation coefficients.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        radiation_damping : Array of floats</span>
<span class="sd">            Damping coefficients.</span>
<span class="sd">        added_mass : Array of floats</span>
<span class="sd">            Added-mass coefficients.</span>
<span class="sd">        infinite_added_mass : Array of floats, optional</span>
<span class="sd">            Infinite-frequency added mass coefficients.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># TODO: faire verifs !!</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_radiation_db</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">radiation_damping</span><span class="p">,</span> <span class="n">added_mass</span><span class="p">,</span> <span class="n">cm_inf</span><span class="o">=</span><span class="n">infinite_added_mass</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="WaveExcitationError"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.WaveExcitationError">[docs]</a><span class="k">class</span> <span class="nc">WaveExcitationError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="WaveExcitation"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.WaveExcitation">[docs]</a><span class="k">class</span> <span class="nc">WaveExcitation</span><span class="p">(</span><span class="n">_FreqDB</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Class WaveExcitation for dealing with excitation loads.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_type</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">_type_extended</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Constructor of the WaveExcitation class.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">WaveExcitation</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># super(DiffractionDB, self).__init__()</span>
        <span class="c1"># self.min_frequency = 0.</span>
        <span class="c1"># self.max_frequency = 0.</span>
        <span class="c1"># self.nb_frequency = 0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_x_wave_measure</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_wave_measure</span> <span class="o">=</span> <span class="mf">0.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">min_wave_dir</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_wave_dir</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nb_wave_dir</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">body_mapper</span> <span class="o">=</span> <span class="n">HydroBodySetMapping</span><span class="p">()</span>

<div class="viewcode-block" id="WaveExcitation.get_wave_measure_position"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.WaveExcitation.get_wave_measure_position">[docs]</a>    <span class="k">def</span> <span class="nf">get_wave_measure_position</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;This subroutine gives the position of the wave probe.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            x-position.</span>
<span class="sd">        float</span>
<span class="sd">            y-position.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_wave_measure</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_wave_measure</span></div>

<div class="viewcode-block" id="WaveExcitation.set_data"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.WaveExcitation.set_data">[docs]</a>    <span class="k">def</span> <span class="nf">set_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">diffraction_data</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;This subroutine sets the diffraction or FK loads.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        diffraction_data : Array of floats</span>
<span class="sd">            Diffraction or FK loads.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># TODO: faire les verifs...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">diffraction_data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex</span><span class="p">)</span></div>

<div class="viewcode-block" id="WaveExcitation.get_body_data"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.WaveExcitation.get_body_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_body_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ibody</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;This subroutine gives the diffraction or FK loads for a body.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ibody : int</span>
<span class="sd">            Index of the body.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Array of floats</span>
<span class="sd">            Diffraction or FK loads.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">nb_dof</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_mapper</span><span class="o">.</span><span class="n">bodies</span><span class="p">[</span><span class="n">ibody</span><span class="p">]</span><span class="o">.</span><span class="n">nb_dof</span>

        <span class="n">istart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_mapper</span><span class="o">.</span><span class="n">get_general_force_index</span><span class="p">(</span><span class="n">ibody</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="c1"># istop = self.body_mapper.get_general_force_index(ibody, nb_dof-1)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">istart</span><span class="p">:</span><span class="n">istart</span><span class="o">+</span><span class="n">nb_dof</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span></div>

<div class="viewcode-block" id="WaveExcitation.interp"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.WaveExcitation.interp">[docs]</a>    <span class="k">def</span> <span class="nf">interp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">wave_dir</span><span class="p">,</span> <span class="n">ibody</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Interpolate wave excitation hydrodynamic coefficient over frequency and wave directions</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        omega : np.ndarray</span>
<span class="sd">            angular frequencies at which the database has to be interpolated</span>
<span class="sd">        wave_dir : np.ndarray</span>
<span class="sd">            wave directions at which the database has to be interpolated</span>
<span class="sd">        ibody : int, optional</span>
<span class="sd">            The id of the hydrodynamic body in the database. If None (default), the full results for every bodies in</span>
<span class="sd">            interaction will be interpolated</span>
<span class="sd">        unit = &#39;str&#39;, optional</span>
<span class="sd">            The angle unit used in wave_dir. Default is &#39;deg&#39;. May also be &#39;rad&#39;</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.ndarray[complex]</span>
<span class="sd">            Complex array of hydrodynamic coefficients interpolated at requested places.</span>
<span class="sd">            </span>
<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        Error if the requested values are outside the ranges of the database</span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Interpolation in database allows to set a linear wavefield with a different discretization than the database.</span>
<span class="sd">        It is of practical usage when the database has been realized with numerous values so that it covers the</span>
<span class="sd">        broader range of simulations but are over-discretized with respect to the needs in excitation force</span>
<span class="sd">        computations as they would give a too computational demanding double sum.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">ibody</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_body_data</span><span class="p">(</span><span class="n">ibody</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;deg&#39;</span><span class="p">:</span>
            <span class="n">wave_dir</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">wave_dir</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">unit</span> <span class="o">!=</span> <span class="s1">&#39;rad&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">WaveExcitationError</span><span class="p">(</span><span class="s2">&quot;Angle unit must be &#39;deg&#39; or &#39;rad&#39;, not </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">unit</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">omega</span><span class="p">):</span>
            <span class="n">omega</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">omega</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">wave_dir</span><span class="p">):</span>
            <span class="n">wave_dir</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">wave_dir</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
        
        <span class="n">wmin</span><span class="p">,</span> <span class="n">wmax</span><span class="p">,</span> <span class="n">nw</span> <span class="o">=</span> <span class="n">omega</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">omega</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">omega</span><span class="p">)</span>
        <span class="n">min_wave_dir</span><span class="p">,</span> <span class="n">max_wave_dir</span><span class="p">,</span> <span class="n">nb_wave_dir</span> <span class="o">=</span> <span class="n">wave_dir</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">wave_dir</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">wave_dir</span><span class="p">)</span>
        
        <span class="c1"># Testing if requested values are consistent with the current database (no extrapolation allowed)</span>
        <span class="k">if</span> <span class="n">wmin</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_frequency</span> <span class="ow">or</span> <span class="n">wmax</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_frequency</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">WaveExcitationError</span><span class="p">(</span><span class="s1">&#39;Interpolation values for </span><span class="si">%s</span><span class="s1"> in frequency are outside the values that are &#39;</span>
                                      <span class="s1">&#39;available in the database [</span><span class="si">%.3f</span><span class="s1">, </span><span class="si">%.3f</span><span class="s1">] rad/s. No extrapolation are allowed on &#39;</span>
                                      <span class="s1">&#39;hydrodynamic databases.&#39;</span>
                                      <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_frequency</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_frequency</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="n">min_wave_dir</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_wave_dir</span> <span class="ow">or</span> <span class="n">max_wave_dir</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_wave_dir</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">WaveExcitationError</span><span class="p">(</span><span class="s1">&#39;Interpolation values for </span><span class="si">%s</span><span class="s1"> in wave direction are outside the values that are &#39;</span>
                                      <span class="s1">&#39;available in the database [</span><span class="si">%.3f</span><span class="s1">, </span><span class="si">%.3f</span><span class="s1">] deg. No extrapolation are allowed on &#39;</span>
                                      <span class="s1">&#39;hydrodynamic databases.&#39;</span>
                                      <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">degrees</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_wave_dir</span><span class="p">),</span> <span class="n">degrees</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_wave_dir</span><span class="p">)))</span>
        
        <span class="c1"># Initial values from the database</span>
        <span class="n">omega_db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">omega</span>
        <span class="n">beta_db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wave_dir</span>
        
        <span class="n">n_force</span><span class="p">,</span> <span class="n">nwi</span><span class="p">,</span> <span class="n">nbi</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nw</span><span class="p">,</span> <span class="n">nb_wave_dir</span>
        
        <span class="n">fexc_interp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_force</span><span class="p">,</span> <span class="n">nwi</span><span class="p">,</span> <span class="n">nbi</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">iforce</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="c1"># TODO: voir pour une interpolation collective (sans boucle)</span>
            <span class="c1"># TODO: voir pour une interpolation directement en complexes (pas real puis imag)</span>
            <span class="n">fexc</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">iforce</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>  <span class="c1"># is nw x nbeta</span>
            
            
            <span class="c1"># TODO: voir si on ne stocke pas de base les interpolateurs dans la database a l&#39;initialisation des donnees</span>
            <span class="n">interp_real</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp2d</span><span class="p">(</span><span class="n">beta_db</span><span class="p">,</span> <span class="n">omega_db</span><span class="p">,</span> <span class="n">fexc</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>  <span class="c1"># type: interpolate.interp2d</span>
            <span class="n">interp_imag</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp2d</span><span class="p">(</span><span class="n">beta_db</span><span class="p">,</span> <span class="n">omega_db</span><span class="p">,</span> <span class="n">fexc</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span>  <span class="c1"># type: interpolate.interp2d</span>
            
            <span class="n">fexc_interp</span><span class="p">[</span><span class="n">iforce</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">interp_real</span><span class="p">(</span><span class="n">wave_dir</span><span class="p">,</span> <span class="n">omega</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">interp_imag</span><span class="p">(</span><span class="n">wave_dir</span><span class="p">,</span> <span class="n">omega</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="n">fexc_interp</span></div>

<div class="viewcode-block" id="WaveExcitation.set_wave_dir"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.WaveExcitation.set_wave_dir">[docs]</a>    <span class="k">def</span> <span class="nf">set_wave_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_wave_dir</span><span class="p">,</span> <span class="n">max_wave_dir</span><span class="p">,</span> <span class="n">nb_wave_dir</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;This subroutine sets the wave directions.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        min_wave_dir : float</span>
<span class="sd">            Minimum wave direction.</span>
<span class="sd">        max_wave_dir : float</span>
<span class="sd">            Maximum wave direction.</span>
<span class="sd">        nb_wave_dir : int</span>
<span class="sd">            Wave direction angular step.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">assert</span> <span class="n">min_wave_dir</span> <span class="o">&lt;=</span> <span class="n">max_wave_dir</span>
        <span class="k">assert</span> <span class="n">nb_wave_dir</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_wave_dir</span> <span class="o">=</span> <span class="n">min_wave_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_wave_dir</span> <span class="o">=</span> <span class="n">max_wave_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nb_wave_dir</span> <span class="o">=</span> <span class="n">nb_wave_dir</span></div>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">wave_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c1"># TODO: methode de DiffractionDB (et excitation DB)</span>
        <span class="sd">&quot;&quot;&quot;Wave direction angles array of BEM computations in radians</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.ndarray</span>
<span class="sd">            angles array in radians</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_wave_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_wave_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_wave_dir</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">))</span>

<div class="viewcode-block" id="WaveExcitation.get_complex_coeffs"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.WaveExcitation.get_complex_coeffs">[docs]</a>    <span class="k">def</span> <span class="nf">get_complex_coeffs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ibody</span><span class="p">,</span> <span class="n">iforce</span><span class="p">,</span> <span class="n">iwave</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>  <span class="c1"># TODO: Methode de DiffractionDB</span>
        <span class="sd">&quot;&quot;&quot;Get the diffraction coefficients for a body&#39;s mode and a given wave direction</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ibody : int</span>
<span class="sd">            The index of the body</span>
<span class="sd">        iforce : int</span>
<span class="sd">            The index of the wanted body&#39;s integration mode</span>
<span class="sd">        iwave : int, float</span>
<span class="sd">            Wave direction. If an int is given, it is used as an index in the wave_dir array. If a float is given, the</span>
<span class="sd">            closest wave direction is given</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.ndarray</span>
<span class="sd">            Complex array of the diffraction coefficients</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">iwave</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="c1"># Finding the closest wave direction</span>
            <span class="n">iwave</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wave_dir</span> <span class="o">-</span> <span class="n">radians</span><span class="p">(</span><span class="n">iwave</span><span class="p">))</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
        
        <span class="c1"># gal_idx = self.body_mapper.</span>
        <span class="n">gal_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_mapper</span><span class="o">.</span><span class="n">get_general_force_index</span><span class="p">(</span><span class="n">ibody</span><span class="p">,</span> <span class="n">iforce</span><span class="p">)</span> <span class="c1"># gal = general index.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iwcut</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">gal_idx</span><span class="p">,</span> <span class="p">:,</span> <span class="n">iwave</span><span class="p">]</span>  <span class="c1"># is</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">gal_idx</span><span class="p">,</span> <span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">_iwcut</span><span class="p">,</span> <span class="n">iwave</span><span class="p">]</span></div>

<div class="viewcode-block" id="WaveExcitation.plot"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.WaveExcitation.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ibody</span><span class="p">,</span> <span class="n">iforce</span><span class="p">,</span> <span class="n">iwave</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plots the diffraction response function of a given modes set</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ibody : int</span>
<span class="sd">            The index of the body</span>
<span class="sd">        iforce : int</span>
<span class="sd">            The index of the body&#39;s force mode</span>
<span class="sd">        iwave : int, float</span>
<span class="sd">            The index of the wave direction (if an integer is given) or the value of the wave_direction in degrees in a</span>
<span class="sd">            float is given. In the latter case, the most close angle is taken (not necessarily the one that is given</span>
<span class="sd">            here...)</span>
<span class="sd">        kwargs: optional</span>
<span class="sd">            Arguments that are to be used by pyplot</span>
<span class="sd">        &quot;&quot;&quot;</span>
    
        <span class="n">coeffs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_complex_coeffs</span><span class="p">(</span><span class="n">ibody</span><span class="p">,</span> <span class="n">iforce</span><span class="p">,</span> <span class="n">iwave</span><span class="p">)</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\omega (rad/s)$&#39;</span>
        <span class="n">ylabel1</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$|F_{</span><span class="si">%s</span><span class="s1">}(\omega)|$&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span>
        <span class="n">ylabel2</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\angle\left[F_{</span><span class="si">%s</span><span class="s1">}(\omega)\right] (deg)$&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span>
        
        <span class="n">mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_mapper</span><span class="o">.</span><span class="n">bodies</span><span class="p">[</span><span class="n">ibody</span><span class="p">]</span><span class="o">.</span><span class="n">force_modes</span><span class="p">[</span><span class="n">iforce</span><span class="p">]</span>
        
        <span class="c1"># mode = self.bodies[ibody].force_modes[iforce]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">ForceMode</span><span class="p">):</span>
            <span class="n">ylabel1</span> <span class="o">+=</span> <span class="sa">r</span><span class="s1">&#39; $(N/m)$&#39;</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">MomentMode</span><span class="p">):</span>
            <span class="n">ylabel1</span> <span class="o">+=</span> <span class="sa">r</span><span class="s1">&#39; $(N)$&#39;</span>
    
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">iwave</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">beta</span> <span class="o">=</span> <span class="n">degrees</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wave_dir</span><span class="p">[</span><span class="n">iwave</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Finding the closest wave direction</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wave_dir</span> <span class="o">-</span> <span class="n">radians</span><span class="p">(</span><span class="n">iwave</span><span class="p">))</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
            <span class="n">beta</span> <span class="o">=</span> <span class="n">degrees</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wave_dir</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    
        <span class="n">title</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> force on body </span><span class="si">%u</span><span class="s1"> along mode </span><span class="si">%u</span><span class="s1"> for wave direction </span><span class="si">%.1f</span><span class="s1"> deg&#39;</span> <span class="o">%</span> \
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_type_extended</span><span class="p">,</span> <span class="n">ibody</span><span class="p">,</span> <span class="n">iforce</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>
    
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># TODO: faire une fonction externe pour ne pas reecrire cela pour plot_radiation ?</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">omega</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">coeffs</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel1</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">omega</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">coeffs</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel2</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div></div>
    

<div class="viewcode-block" id="DiffractionDB"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.DiffractionDB">[docs]</a><span class="k">class</span> <span class="nc">DiffractionDB</span><span class="p">(</span><span class="n">WaveExcitation</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Class DiffractionDB for dealing with diffraction loads.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_type</span> <span class="o">=</span> <span class="s1">&#39;diff&#39;</span>
    <span class="n">_type_extended</span> <span class="o">=</span> <span class="s1">&#39;Diffraction&#39;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Constructor of the DiffractionDB class.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">DiffractionDB</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span></div>
        
        
<div class="viewcode-block" id="FroudeKrylovDB"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.FroudeKrylovDB">[docs]</a><span class="k">class</span> <span class="nc">FroudeKrylovDB</span><span class="p">(</span><span class="n">WaveExcitation</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Class FroudeKrylovDB for dealing with diffraction loads.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_type</span> <span class="o">=</span> <span class="s1">&#39;FK&#39;</span>
    <span class="n">_type_extended</span> <span class="o">=</span> <span class="s1">&#39;Froude Krylov&#39;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Constructor of the FroudeKrylovDB class.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">FroudeKrylovDB</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># self.depth = depth</span>
        <span class="c1"># self.grav = grav</span>
        <span class="c1"># self.x_wave_measure = x_wave_measure</span>
        <span class="c1"># self.y_wave_measure = y_wave_measure</span>

<div class="viewcode-block" id="FroudeKrylovDB.eval"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.FroudeKrylovDB.eval">[docs]</a>    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rho_water</span><span class="p">,</span> <span class="n">grav</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">x_wave_measure</span><span class="p">,</span> <span class="n">y_wave_measure</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;This subroutine computes the Froude-Krylov complex coefficients from the incident wave field.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rho_water : float</span>
<span class="sd">            Water density.</span>
<span class="sd">        grav : float</span>
<span class="sd">            Gravity.</span>
<span class="sd">        depth : float</span>
<span class="sd">            Water depth</span>
<span class="sd">        x_wave_measure : float</span>
<span class="sd">            x-position of the wave probe.</span>
<span class="sd">        y_wave_measure : float</span>
<span class="sd">            y-position of the wave probe.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="sd">&quot;&quot;&quot;Computes the Froude-Krylov complex coefficients from indident wave field&quot;&quot;&quot;</span>
        <span class="c1"># Remarque: l&#39;evaluation est faite sur le full range de frequence (wcut est bypassed)</span>
        <span class="c1"># TODO: sortir le potentiel, les pressions et les vitesses normales...</span>

        <span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">wave_dispersion_relation</span> <span class="k">as</span> <span class="n">wdr</span>

        <span class="n">omega</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_full_omega</span><span class="p">()</span>
        <span class="n">k_wave</span> <span class="o">=</span> <span class="n">wdr</span><span class="o">.</span><span class="n">solve_wave_dispersion_relation</span><span class="p">(</span><span class="n">omega</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">grav</span><span class="p">)</span>
        <span class="c1"># g_w = self.grav / omega</span>
        
        <span class="n">body_mapper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_mapper</span>
        
        <span class="n">froude_krylov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">body_mapper</span><span class="o">.</span><span class="n">nb_force_modes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nb_frequencies</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_wave_dir</span><span class="p">),</span>
                                 <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex</span><span class="p">)</span>
    
        <span class="n">i_global_force</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">body</span> <span class="ow">in</span> <span class="n">body_mapper</span><span class="o">.</span><span class="n">bodies</span><span class="p">:</span>  <span class="c1"># TODO: rendre body_mapper iterable</span>
            <span class="c1"># normals = body.mesh.faces_normals</span>
            <span class="c1"># areas = body.mesh.faces_areas</span>
            <span class="n">centers</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">faces_centers</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">centers</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">centers</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">centers</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
        
            <span class="c1"># COMPUTING FIELDS</span>
            <span class="n">ctheta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wave_dir</span><span class="p">)</span>  <span class="c1"># is ntheta</span>
            <span class="n">stheta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wave_dir</span><span class="p">)</span>  <span class="c1"># is ntheta</span>
        
            <span class="n">kctheta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;i, j -&gt; ij&#39;</span><span class="p">,</span> <span class="n">k_wave</span><span class="p">,</span> <span class="n">ctheta</span><span class="p">)</span>  <span class="c1"># is nw x ntheta</span>
            <span class="n">kstheta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;i, j -&gt; ij&#39;</span><span class="p">,</span> <span class="n">k_wave</span><span class="p">,</span> <span class="n">stheta</span><span class="p">)</span>  <span class="c1"># is nw x ntheta</span>
        
            <span class="n">kw_bar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;i, jk -&gt; ijk&#39;</span><span class="p">,</span> <span class="n">x</span> <span class="o">-</span> <span class="n">x_wave_measure</span><span class="p">,</span> <span class="n">kctheta</span><span class="p">)</span>
            <span class="n">kw_bar</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;i, jk -&gt; ijk&#39;</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="n">y_wave_measure</span><span class="p">,</span> <span class="n">kstheta</span><span class="p">)</span>  <span class="c1"># is nf x nw x ntheta</span>
            <span class="n">exp_jkw_bar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">kw_bar</span><span class="p">)</span>  <span class="c1"># is nf x nw x ntheta</span>
            
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">depth</span><span class="p">):</span>
                <span class="c1"># Infinite depth</span>
                <span class="n">kxzph</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;i, j -&gt; ij&#39;</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">k_wave</span><span class="p">)</span>  <span class="c1"># is nf x nw</span>
                <span class="n">cih</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">kxzph</span><span class="p">)</span>  <span class="c1"># is nf x nw</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Finite depth</span>
                <span class="n">kxzph</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;i, j -&gt; ij&#39;</span><span class="p">,</span> <span class="n">z</span> <span class="o">+</span> <span class="n">depth</span><span class="p">,</span> <span class="n">k_wave</span><span class="p">)</span>  <span class="c1"># is nf x nw</span>
                <span class="n">chkh_1</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">cosh</span><span class="p">(</span><span class="n">k_wave</span> <span class="o">*</span> <span class="n">depth</span><span class="p">)</span>  <span class="c1"># is nw</span>

                <span class="n">cih</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij, j -&gt; ij&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">cosh</span><span class="p">(</span><span class="n">kxzph</span><span class="p">),</span> <span class="n">chkh_1</span><span class="p">)</span>  <span class="c1"># is nf x nw</span>
                <span class="n">sih</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij, j -&gt; ij&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sinh</span><span class="p">(</span><span class="n">kxzph</span><span class="p">),</span> <span class="n">chkh_1</span><span class="p">)</span>  <span class="c1"># is nf x nw</span>


        
            <span class="n">cih_exp_jkw_bar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij, ijk -&gt; ijk&#39;</span><span class="p">,</span> <span class="n">cih</span><span class="p">,</span> <span class="n">exp_jkw_bar</span><span class="p">)</span>  <span class="c1"># is nf x nw x ntheta</span>
            <span class="c1"># sih_exp_jkw_bar = np.einsum(&#39;ij, ijk -&gt; ijk&#39;, sih, exp_jkw_bar)  # is nf x nw x ntheta</span>
        
            <span class="c1"># g_w_cih_exp_jkw_bar = np.einsum(&#39;j, ijk -&gt; ijk&#39;, g_w, cih_exp_jkw_bar)  # is nf x nw x ntheta</span>
            <span class="c1"># g_w_sih_exp_jkw_bar = np.einsum(&#39;j, ijk -&gt; ijk&#39;, g_w, sih_exp_jkw_bar)  # is nf x nw x ntheta</span>
        
            <span class="c1"># incident_potential = -1j * g_w_cih_exp_jkw_bar  # is nf x nw x ntheta</span>
            <span class="n">pressure</span> <span class="o">=</span> <span class="n">rho_water</span> <span class="o">*</span> <span class="n">grav</span> <span class="o">*</span> <span class="n">cih_exp_jkw_bar</span>  <span class="c1"># is nf x nw x ntheta</span>
        
            <span class="c1"># i, j, k = pressure.shape</span>
            <span class="c1"># velocities = np.zeros((i, j, k, 3), dtype=np.complex)  # is nf x nw x ntheta x 3</span>
            <span class="c1"># velocities[:, :, :, 0] = np.einsum(&#39;ijk, jk -&gt; ijk&#39;, g_w_cih_exp_jkw_bar, kctheta)</span>
            <span class="c1"># velocities[:, :, :, 1] = np.einsum(&#39;ijk, jk -&gt; ijk&#39;, g_w_cih_exp_jkw_bar, kstheta)</span>
            <span class="c1"># velocities[:, :, :, 2] = -1j * np.einsum(&#39;j, ijk -&gt; ijk&#39;, k_wave, g_w_sih_exp_jkw_bar)</span>
        
            <span class="c1"># normal_velocities = - np.einsum(&#39;ijkl, il -&gt; ijk&#39;, velocities, normals)  # is nf x nw x ntheta</span>
        
            <span class="k">for</span> <span class="n">iforce</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">nb_force_modes</span><span class="p">):</span>
                <span class="n">nds</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get_nds</span><span class="p">(</span><span class="n">iforce</span><span class="p">)</span>
                <span class="c1"># froude_krylov[i_global_force, :, :] =  np.einsum(&#39;ijk, i -&gt; jk&#39;, pressure, nds)</span>
                <span class="n">froude_krylov</span><span class="p">[</span><span class="n">i_global_force</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ijk, i -&gt; jk&#39;</span><span class="p">,</span> <span class="n">pressure</span><span class="p">,</span> <span class="o">-</span><span class="n">nds</span><span class="p">)</span> <span class="c1">#Il s&#39;agit de la normale entrante</span>
                <span class="n">i_global_force</span> <span class="o">+=</span> <span class="mi">1</span>
    
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">froude_krylov</span></div></div>
    

<div class="viewcode-block" id="WaveExcitationDB"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.WaveExcitationDB">[docs]</a><span class="k">class</span> <span class="nc">WaveExcitationDB</span><span class="p">(</span><span class="n">WaveExcitation</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Class WaveExcitationDB for dealing with exciting loads.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_type</span> <span class="o">=</span> <span class="s1">&#39;exc&#39;</span>
    <span class="n">_type_extended</span> <span class="o">=</span> <span class="s1">&#39;Excitation&#39;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Constructor of the DiffractionDB class.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">WaveExcitationDB</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span></div>


<span class="c1"># TODO: voir a faire une moyenne des coeffs hors diag pour le meme corps</span>
<div class="viewcode-block" id="RadiationDB"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.RadiationDB">[docs]</a><span class="k">class</span> <span class="nc">RadiationDB</span><span class="p">(</span><span class="n">_FreqDB</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class to hold hydrodynamic radiation coefficients</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Constructor of the FroudeKrylovDB class.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">RadiationDB</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_ca</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cm</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_cm_inf</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_irf_db</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_irf_ku_db</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">body_mapper</span> <span class="o">=</span> <span class="n">HydroBodySetMapping</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
        
<div class="viewcode-block" id="RadiationDB.set_data"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.RadiationDB.set_data">[docs]</a>    <span class="k">def</span> <span class="nf">set_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ca</span><span class="p">,</span> <span class="n">cm</span><span class="p">,</span> <span class="n">cm_inf</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;This subroutine sets the radiation coefficients.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ca : Array of floats</span>
<span class="sd">            Damping coefficients.</span>
<span class="sd">        cm : Array of floats</span>
<span class="sd">            Added mass coefficients.</span>
<span class="sd">        cm_inf : Array of floats, optional</span>
<span class="sd">            Infinite-frequency added mass coefficients.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_ca</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ca</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cm_inf</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cm_inf</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cm_inf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">cm_inf</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
        
        <span class="n">nf</span><span class="p">,</span> <span class="n">nw</span><span class="p">,</span> <span class="n">nm</span> <span class="o">=</span> <span class="n">ca</span><span class="o">.</span><span class="n">shape</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">nm</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span></div>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">radiation_damping</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;This subroutine gives the damping coefficients.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Array of floats</span>
<span class="sd">            Damping coefficients.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iwcut</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ca</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ca</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ca</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ca</span><span class="p">[:,</span> <span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">_iwcut</span><span class="p">,</span> <span class="p">:]</span>  <span class="c1"># TODO: changer l&#39;ordre des dimensions et avoir (iforce, irad, iw)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ijk, ik -&gt; ijk&#39;</span><span class="p">,</span> <span class="n">ca</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span><span class="p">)</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">added_mass</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;This subroutine gives the added-mass coefficients.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Array of floats</span>
<span class="sd">            Added-mass coefficients.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iwcut</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cm</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cm</span><span class="p">[:,</span> <span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">_iwcut</span><span class="p">,</span> <span class="p">:]</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ijk, ik -&gt; ijk&#39;</span><span class="p">,</span> <span class="n">cm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span><span class="p">)</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">infinite_added_mass</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;This subroutine gives the infinite-frequency added mass coefficients.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Array of floats</span>
<span class="sd">            Infinite-frequency added mass coefficients.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cm_inf</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cm_inf</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">flags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span>
    
    <span class="nd">@flags</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">flags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flags</span><span class="p">):</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_mapper</span><span class="o">.</span><span class="n">nb_force_modes</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_mapper</span><span class="o">.</span><span class="n">nb_motion_modes</span>
        <span class="k">assert</span> <span class="n">flags</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span> <span class="o">=</span> <span class="n">flags</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">frequency_response</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the complex radiation frequency response (radiation transfer function)</span>
<span class="sd">    </span>
<span class="sd">        This is K(jw) = CA(w) + jw(CM(w)-CMinf).</span>
<span class="sd">        It is to be used in identification procedures</span>
<span class="sd">    </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.ndarray</span>
<span class="sd">            (nb_force_modes x nb_frequencies x nb_motion_modes) Complex array of radiation frequency responses</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ca</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">radiation_damping</span>
        <span class="n">cm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">added_mass</span>
    
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cm_inf</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eval_infinite_added_mass</span><span class="p">()</span>
    
        <span class="n">cminf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infinite_added_masslot</span>
    
        <span class="k">return</span> <span class="n">ca</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;j, ijk -&gt; ijk&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">omega</span><span class="p">,</span> <span class="n">cm</span> <span class="o">-</span> <span class="n">cminf</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:])</span>
    
<div class="viewcode-block" id="RadiationDB.clean"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.RadiationDB.clean">[docs]</a>    <span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c1"># FIXME: affiner la methode !!!!!!</span>

        <span class="sd">&quot;&quot;&quot;This subroutine cleans the impulse response functions.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">irf_db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_impulse_response_function</span><span class="p">()</span>
        <span class="n">irf_db</span><span class="o">.</span><span class="n">clean</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">irf_db</span><span class="o">.</span><span class="n">flags</span></div>
        
<div class="viewcode-block" id="RadiationDB.reinit"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.RadiationDB.reinit">[docs]</a>    <span class="k">def</span> <span class="nf">reinit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span> <span class="o">=</span> <span class="kc">True</span></div>
    
<div class="viewcode-block" id="RadiationDB.get_frequency_response"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.RadiationDB.get_frequency_response">[docs]</a>    <span class="k">def</span> <span class="nf">get_frequency_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ibody_motion</span><span class="p">,</span> <span class="n">idof</span><span class="p">,</span> <span class="n">ibody_force</span><span class="p">,</span> <span class="n">iforce</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the radiation frequency response for a given modes set</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ibody_motion : int</span>
<span class="sd">            Index of the body having a motion</span>
<span class="sd">        idof : int</span>
<span class="sd">            Index of the local body&#39;s raditation mode (motion)</span>
<span class="sd">        ibody_force : int</span>
<span class="sd">            Index of the body where the radiation force is applied</span>
<span class="sd">        iforce : int</span>
<span class="sd">            Index of the local body&#39;s force mode</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.ndarray</span>
<span class="sd">            Complex array of radiation frequency response</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kjw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_response</span>
        
        <span class="n">idof_gal</span><span class="p">,</span> <span class="n">iforce_gal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_mapper</span><span class="o">.</span><span class="n">get_general_indexes</span><span class="p">(</span><span class="n">ibody_motion</span><span class="p">,</span> <span class="n">idof</span><span class="p">,</span> <span class="n">ibody_force</span><span class="p">,</span> <span class="n">iforce</span><span class="p">)</span> <span class="c1"># gal = general index.</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span><span class="p">[</span><span class="n">idof_gal</span><span class="p">,</span> <span class="n">iforce_gal</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">kjw</span><span class="p">[</span><span class="n">iforce_gal</span><span class="p">,</span> <span class="p">:,</span> <span class="n">idof_gal</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nb_frequencies</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="RadiationDB.get_added_mass_coeff"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.RadiationDB.get_added_mass_coeff">[docs]</a>    <span class="k">def</span> <span class="nf">get_added_mass_coeff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ibody_motion</span><span class="p">,</span> <span class="n">idof</span><span class="p">,</span> <span class="n">ibody_force</span><span class="p">,</span> <span class="n">iforce</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the frequency dependent added-mass coefficients.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ibody_motion : int</span>
<span class="sd">            Index of the body having a motion</span>
<span class="sd">        idof : int</span>
<span class="sd">            Index of the local body&#39;s radiation mode (motion)</span>
<span class="sd">        ibody_force : int</span>
<span class="sd">            Index of the body where the radiation force is applied</span>
<span class="sd">        iforce : int</span>
<span class="sd">            Index of the local body&#39;s force mode</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.ndarray</span>
<span class="sd">            nb_frequencies array of Added mass frequency components</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">idof_gal</span><span class="p">,</span> <span class="n">iforce_gal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_mapper</span><span class="o">.</span><span class="n">get_general_indexes</span><span class="p">(</span><span class="n">ibody_motion</span><span class="p">,</span> <span class="n">idof</span><span class="p">,</span> <span class="n">ibody_force</span><span class="p">,</span> <span class="n">iforce</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span><span class="p">[</span><span class="n">idof_gal</span><span class="p">,</span> <span class="n">iforce_gal</span><span class="p">]:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">added_mass</span><span class="p">[</span><span class="n">iforce_gal</span><span class="p">,</span> <span class="p">:,</span> <span class="n">idof_gal</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nb_frequencies</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span></div>

<div class="viewcode-block" id="RadiationDB.get_added_mass"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.RadiationDB.get_added_mass">[docs]</a>    <span class="k">def</span> <span class="nf">get_added_mass</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ibody_force</span><span class="p">,</span> <span class="n">ibody_motion</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;This subroutine gets the frequency-dependent added-mass matrices.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ibody_force : int</span>
<span class="sd">            Index of the body where the radiation force is applied</span>
<span class="sd">        ibody_motion : int</span>
<span class="sd">            Index of the body having a motion</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.ndarray</span>
<span class="sd">            Frequency-dependent added-mass matrices.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># First index.</span>
        <span class="n">idof_start</span><span class="p">,</span> <span class="n">iforce_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_mapper</span><span class="o">.</span><span class="n">get_general_indexes</span><span class="p">(</span><span class="n">ibody_motion</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ibody_force</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="c1"># 0 = first index.</span>

        <span class="n">nb_force</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_mapper</span><span class="o">.</span><span class="n">get_body</span><span class="p">(</span><span class="n">ibody_force</span><span class="p">)</span><span class="o">.</span><span class="n">nb_force_modes</span>
        <span class="n">nb_dof</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_mapper</span><span class="o">.</span><span class="n">get_body</span><span class="p">(</span><span class="n">ibody_motion</span><span class="p">)</span><span class="o">.</span><span class="n">nb_dof</span>

        <span class="c1"># Last index.</span>
        <span class="n">idof_end</span><span class="p">,</span> <span class="n">iforce_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_mapper</span><span class="o">.</span><span class="n">get_general_indexes</span><span class="p">(</span><span class="n">ibody_motion</span><span class="p">,</span> <span class="n">nb_dof</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">ibody_force</span><span class="p">,</span> <span class="n">nb_force</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># nb_dof-1 and nb_force-1 = last indexes.</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">added_mass</span><span class="p">[</span><span class="n">iforce_start</span><span class="p">:</span><span class="n">iforce_end</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="n">idof_start</span><span class="p">:</span><span class="n">idof_end</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span></div>

<div class="viewcode-block" id="RadiationDB.get_radiation_damping_coeff"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.RadiationDB.get_radiation_damping_coeff">[docs]</a>    <span class="k">def</span> <span class="nf">get_radiation_damping_coeff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ibody_motion</span><span class="p">,</span> <span class="n">idof</span><span class="p">,</span> <span class="n">ibody_force</span><span class="p">,</span> <span class="n">iforce</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the frequency dependent radiation damping coefficient</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ibody_motion : int</span>
<span class="sd">            Index of the body having a motion</span>
<span class="sd">        idof : int</span>
<span class="sd">            Index of the local body&#39;s radiation mode (motion)</span>
<span class="sd">        ibody_force : int</span>
<span class="sd">            Index of the body where the radiation force is applied</span>
<span class="sd">        iforce : int</span>
<span class="sd">            Index of the local body&#39;s force mode</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.ndarray</span>
<span class="sd">            nb_frequencies array of radiation damping frequency components</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">idof_gal</span><span class="p">,</span> <span class="n">iforce_gal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_mapper</span><span class="o">.</span><span class="n">get_general_indexes</span><span class="p">(</span><span class="n">ibody_motion</span><span class="p">,</span> <span class="n">idof</span><span class="p">,</span> <span class="n">ibody_force</span><span class="p">,</span> <span class="n">iforce</span><span class="p">)</span> <span class="c1"># gal = general index.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span><span class="p">[</span><span class="n">idof_gal</span><span class="p">,</span> <span class="n">iforce_gal</span><span class="p">]:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">radiation_damping</span><span class="p">[</span><span class="n">iforce_gal</span><span class="p">,</span> <span class="p">:,</span> <span class="n">idof_gal</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nb_frequencies</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span></div>

<div class="viewcode-block" id="RadiationDB.get_radiation_damping"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.RadiationDB.get_radiation_damping">[docs]</a>    <span class="k">def</span> <span class="nf">get_radiation_damping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ibody_force</span><span class="p">,</span> <span class="n">ibody_motion</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;This subroutine gets the frequency-dependent damping matrices.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ibody_force : int</span>
<span class="sd">            Index of the body where the radiation force is applied</span>
<span class="sd">        ibody_motion : int</span>
<span class="sd">            Index of the body having a motion</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.ndarray</span>
<span class="sd">            Frequency-dependent damping matrices.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">idof_start</span><span class="p">,</span> <span class="n">iforce_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_mapper</span><span class="o">.</span><span class="n">get_general_indexes</span><span class="p">(</span><span class="n">ibody_motion</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ibody_force</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">nb_force</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_mapper</span><span class="o">.</span><span class="n">get_body</span><span class="p">(</span><span class="n">ibody_force</span><span class="p">)</span><span class="o">.</span><span class="n">nb_force_modes</span>
        <span class="n">nb_dof</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_mapper</span><span class="o">.</span><span class="n">get_body</span><span class="p">(</span><span class="n">ibody_motion</span><span class="p">)</span><span class="o">.</span><span class="n">nb_dof</span>
        <span class="n">idof_end</span><span class="p">,</span> <span class="n">iforce_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_mapper</span><span class="o">.</span><span class="n">get_general_indexes</span><span class="p">(</span><span class="n">ibody_motion</span><span class="p">,</span> <span class="n">nb_dof</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">ibody_force</span><span class="p">,</span> <span class="n">nb_force</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">radiation_damping</span><span class="p">[</span><span class="n">iforce_start</span><span class="p">:</span><span class="n">iforce_end</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="n">idof_start</span><span class="p">:</span><span class="n">idof_end</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span></div>
    
<div class="viewcode-block" id="RadiationDB.eval_impulse_response_function"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.RadiationDB.eval_impulse_response_function">[docs]</a>    <span class="k">def</span> <span class="nf">eval_impulse_response_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tf</span><span class="o">=</span><span class="mf">30.</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Computes the impulse response function</span>

<span class="sd">        It uses the Ogilvie formulas based on radiation damping integration (Inverse Fourier Transform)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tf : float, optional</span>
<span class="sd">            Final time (seconds). Default is 30.</span>
<span class="sd">        dt : float, optional</span>
<span class="sd">            Time step (seconds). Default is None. If None, a time step is computed according to the max</span>
<span class="sd">            frequency of</span>
<span class="sd">            hydrodynamic coefficients (the Nyquist frequency is taken)</span>
<span class="sd">        full : bool, optional</span>
<span class="sd">            If True (default), it will use the full frequency range for computations.</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        RadiationIRFDB:</span>
<span class="sd">            Radiation Impulse Response Database object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">irf_db</span> <span class="o">=</span> <span class="n">RadiationIRFDB</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="n">dt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Using Shannon theorem</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_frequency</span><span class="p">)</span>
    
        <span class="c1"># TODO: Determiner le temps de coupure global</span>
    
        <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">tf</span> <span class="o">+</span> <span class="n">dt</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span>
    
        <span class="n">tf</span> <span class="o">=</span> <span class="n">time</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># It is overwriten !!</span>
        
        <span class="k">if</span> <span class="n">full</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_full_omega</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">omega</span>
            
        <span class="n">wt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;i, j -&gt; ij&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>  <span class="c1"># is nw x nt</span>
        <span class="n">cwt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">wt</span><span class="p">)</span>  <span class="c1"># is nw x nt</span>
        
        <span class="k">if</span> <span class="n">full</span><span class="p">:</span>
            <span class="n">ca</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ijk, ik -&gt; ijk&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ca</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ca</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">radiation_damping</span>
        
        <span class="n">kernel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ijk, jl -&gt; ijkl&#39;</span><span class="p">,</span> <span class="n">ca</span><span class="p">,</span> <span class="n">cwt</span><span class="p">)</span>  <span class="c1"># is nb_forces x nb_motions x nt</span>
    
        <span class="n">irf_data</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">/</span> <span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">kernel</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">w</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># is nb_forces x nb_motions x nt</span>
    
        <span class="n">irf_db</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">tf</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">irf_data</span><span class="p">)</span>
        <span class="n">irf_db</span><span class="o">.</span><span class="n">body_mapper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_mapper</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_irf_db</span> <span class="o">=</span> <span class="n">irf_db</span>

        <span class="k">return</span> <span class="n">irf_db</span></div>

<div class="viewcode-block" id="RadiationDB.get_irf_db"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.RadiationDB.get_irf_db">[docs]</a>    <span class="k">def</span> <span class="nf">get_irf_db</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;This subroutine gives the impulse response function.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        RadiationIRFDB:</span>
<span class="sd">            Radiation Impulse Response Database object.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_irf_db</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eval_impulse_response_function</span><span class="p">(</span><span class="n">tf</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_irf_db</span></div>

<div class="viewcode-block" id="RadiationDB.eval_impulse_response_function_Ku"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.RadiationDB.eval_impulse_response_function_Ku">[docs]</a>    <span class="k">def</span> <span class="nf">eval_impulse_response_function_Ku</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tf</span><span class="o">=</span><span class="mf">30.</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Computes the impulse response function relative to the ship advance speed</span>

<span class="sd">        ref : F. Rongre et al. (Journes de l&#39;Hydrodynamique 2010 - Nantes)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tf : float, optional</span>
<span class="sd">            Final time (seconds). Default is 30.</span>
<span class="sd">        dt : float, optional</span>
<span class="sd">            Time step (seconds). Default is None. If None, a time step is computed according to the max</span>
<span class="sd">            frequency of</span>
<span class="sd">            hydrodynamic coefficients (the Nyquist frequency is taken)</span>
<span class="sd">        full : bool, optional</span>
<span class="sd">            If True (default), it will use the full frequency range for computations.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        RadiationIRFDB:</span>
<span class="sd">            Radiation Impulse Response Database object</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">eval_infinite_added_mass</span><span class="p">()</span>     <span class="c1"># FIXME : pourquoi cela ne fonctionne par en extrieur</span>

        <span class="n">irf_db</span> <span class="o">=</span> <span class="n">RadiationIRFDB</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">dt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Using Shannon theorem</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mf">10.</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_frequency</span><span class="p">)</span>

        <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">tf</span> <span class="o">+</span> <span class="n">dt</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span>

        <span class="n">tf</span> <span class="o">=</span> <span class="n">time</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">full</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_full_omega</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">omega</span>

        <span class="n">wt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;i, j -&gt;ij&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>  <span class="c1"># is nw x nt</span>
        <span class="n">cwt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">wt</span><span class="p">)</span>  <span class="c1"># is nw x nt</span>

        <span class="k">if</span> <span class="n">full</span><span class="p">:</span>
            <span class="n">cm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ijk, ik -&gt; ijk&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">added_mass</span>

        <span class="n">cm_inf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infinite_added_mass</span>

        <span class="n">cm_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
            <span class="n">cm_diff</span><span class="p">[:,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">cm_inf</span><span class="p">[:,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">cm</span><span class="p">[:,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span>

        <span class="n">cm_diff</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">cm_diff</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="n">cm_diff</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">cm_diff</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span>

        <span class="n">kernel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ijk, jl -&gt; ijkl&#39;</span><span class="p">,</span> <span class="n">cm_diff</span><span class="p">,</span> <span class="n">cwt</span><span class="p">)</span>  <span class="c1"># is nb_forces x nb_motions x nt</span>

        <span class="n">irf_data</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.</span> <span class="o">/</span> <span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">kernel</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">w</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">irf_db</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">tf</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">irf_data</span><span class="p">)</span>
        <span class="n">irf_db</span><span class="o">.</span><span class="n">body_mapper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_mapper</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_irf_ku_db</span> <span class="o">=</span> <span class="n">irf_db</span>

        <span class="k">return</span> <span class="n">irf_db</span></div>

<div class="viewcode-block" id="RadiationDB.get_irf_ku"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.RadiationDB.get_irf_ku">[docs]</a>    <span class="k">def</span> <span class="nf">get_irf_ku</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;This subroutine gives the impulse response function relative to the ship advance speed.</span>

<span class="sd">       Returns</span>
<span class="sd">       -------</span>
<span class="sd">       RadiationIRFDB:</span>
<span class="sd">           Radiation Impulse Response Database object.</span>
<span class="sd">       &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_irf_ku_db</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eval_impulse_response_function_Ku</span><span class="p">(</span><span class="n">tf</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_irf_ku_db</span></div>

<div class="viewcode-block" id="RadiationDB.eval_infinite_added_mass"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.RadiationDB.eval_infinite_added_mass">[docs]</a>    <span class="k">def</span> <span class="nf">eval_infinite_added_mass</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Evaluates the infinite added mass matrix coefficients using Ogilvie formula.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        full : bool, optional</span>
<span class="sd">            If True (default), it will use the full frequency range for computations.</span>
<span class="sd">        </span>
<span class="sd">         It uses the Ogilvie formula to get the coefficients from the impulse response functions</span>
<span class="sd">         </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">irf_db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_irf_db</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="n">full</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_full_omega</span><span class="p">()</span>
            <span class="n">cm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cm</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">omega</span>
            <span class="n">cm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">added_mass</span>
            
        <span class="n">time</span> <span class="o">=</span> <span class="n">irf_db</span><span class="o">.</span><span class="n">time</span>
    
        <span class="n">wt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;i, j -&gt; ij&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>  <span class="c1"># is nw x nt</span>
        <span class="n">sin_wt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">wt</span><span class="p">)</span>
    
        <span class="n">irf</span> <span class="o">=</span> <span class="n">irf_db</span><span class="o">.</span><span class="n">data</span>  <span class="c1"># is nint x nrad x nt</span>
    
        <span class="n">kernel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ijk, lk -&gt; iljk&#39;</span><span class="p">,</span> <span class="n">irf</span><span class="p">,</span> <span class="n">sin_wt</span><span class="p">)</span>  <span class="c1"># is nint x nw x nrad x nt</span>
        <span class="n">integral</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ijk, j -&gt; ijk&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">kernel</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">time</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">w</span><span class="p">)</span>  <span class="c1"># is nint x nw x nrad</span>
    
        <span class="bp">self</span><span class="o">.</span><span class="n">_cm_inf</span> <span class="o">=</span> <span class="p">(</span><span class="n">cm</span> <span class="o">+</span> <span class="n">integral</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># is nint x nrad</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cm_inf</span></div>

<div class="viewcode-block" id="RadiationDB.get_infinite_added_mass_matrix"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.RadiationDB.get_infinite_added_mass_matrix">[docs]</a>    <span class="k">def</span> <span class="nf">get_infinite_added_mass_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ibody_force</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ibody_motion</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the infinite added mass matrix for forces on one body and motions of a possibly other body</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ibody_force : int, optional</span>
<span class="sd">            Index of body on which radiation forces applies. If None (default), every lines of the system will be taken</span>
<span class="sd">        ibody_motion : int, optional</span>
<span class="sd">            Index of body that performs motions. If None (default), every degree of freedom of the system will be taken</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.ndarray</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        * It both index are used and are equal, the &#39;pure&#39; added mass matrix of a body is returned</span>
<span class="sd">        * If both index are used but are different, coupling matrices are returned</span>
<span class="sd">        * If only the first index is given, then lines of the returned matrix correspond to forces on the</span>
<span class="sd">          corresponding body but columns concern every degree of freedom of the system</span>
<span class="sd">        * If only the second index is given, then lines of the returned matrix concern forces on every body of the</span>
<span class="sd">          structure but columns only concern the degree of freedom of the specified body</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ibody_force</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_mapper</span><span class="o">.</span><span class="n">nb_force_modes</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">body_force</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_mapper</span><span class="o">.</span><span class="n">bodies</span><span class="p">[</span><span class="n">ibody_force</span><span class="p">]</span>
            <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span> <span class="o">=</span> <span class="n">body_force</span><span class="o">.</span><span class="n">force_modes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">general_index</span><span class="p">,</span> <span class="n">body_force</span><span class="o">.</span><span class="n">force_modes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">general_index</span> <span class="o">+</span> <span class="mi">1</span>
    
        <span class="k">if</span> <span class="n">ibody_motion</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_mapper</span><span class="o">.</span><span class="n">nb_motion_modes</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">body_motion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_mapper</span><span class="o">.</span><span class="n">bodies</span><span class="p">[</span><span class="n">ibody_motion</span><span class="p">]</span>
            <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span> <span class="o">=</span> <span class="n">body_motion</span><span class="o">.</span><span class="n">motion_modes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">general_index</span><span class="p">,</span> <span class="n">body_motion</span><span class="o">.</span><span class="n">motion_modes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">general_index</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">infinite_added_mass</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eval_infinite_added_mass</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">infinite_added_mass</span><span class="p">[</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">,</span> <span class="n">j1</span><span class="p">:</span><span class="n">j2</span><span class="p">]</span></div>
    
<div class="viewcode-block" id="RadiationDB.plot"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.RadiationDB.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ibody_motion</span><span class="p">,</span> <span class="n">idof</span><span class="p">,</span> <span class="n">ibody_force</span><span class="p">,</span> <span class="n">iforce</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plots the radiation coefficients of a given modes set</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ibody_motion : int</span>
<span class="sd">            Index of the body having a motion</span>
<span class="sd">        idof : int</span>
<span class="sd">            Index of the local body&#39;s radiation mode (motion)</span>
<span class="sd">        ibody_force : int</span>
<span class="sd">            Index of the body where the radiation force is applied</span>
<span class="sd">        iforce : int</span>
<span class="sd">            Index of the local body&#39;s force mode</span>
<span class="sd">        kwargs: optional</span>
<span class="sd">            Arguments that are to be used by pyplot</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cm_inf</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">has_cminf</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">has_cminf</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">ca</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_radiation_damping_coeff</span><span class="p">(</span><span class="n">ibody_motion</span><span class="p">,</span> <span class="n">idof</span><span class="p">,</span> <span class="n">ibody_force</span><span class="p">,</span> <span class="n">iforce</span><span class="p">)</span>
        <span class="n">cm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_added_mass_coeff</span><span class="p">(</span><span class="n">ibody_motion</span><span class="p">,</span> <span class="n">idof</span><span class="p">,</span> <span class="n">ibody_force</span><span class="p">,</span> <span class="n">iforce</span><span class="p">)</span>
        <span class="n">cminf</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="k">if</span> <span class="n">has_cminf</span><span class="p">:</span>
            <span class="n">idof_gal</span><span class="p">,</span> <span class="n">iforce_gal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_mapper</span><span class="o">.</span><span class="n">get_general_indexes</span><span class="p">(</span><span class="n">ibody_motion</span><span class="p">,</span> <span class="n">idof</span><span class="p">,</span> <span class="n">ibody_force</span><span class="p">,</span> <span class="n">iforce</span><span class="p">)</span> <span class="c1"># gal = general index.</span>
            <span class="n">cminf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cm_inf</span><span class="p">[</span><span class="n">iforce_gal</span><span class="p">,</span> <span class="n">idof_gal</span><span class="p">]</span>
    
        <span class="n">xlabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\omega (rad/s)$&#39;</span>
        <span class="n">ylabel1</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$CA(\omega)$&#39;</span>
        <span class="n">ylabel2</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$CM(\omega)$&#39;</span>
    
        <span class="c1"># force_mod = self.bodies[ibody_force].force_modes[iforce]</span>
        <span class="c1"># motion_mod = self.bodies[ibody_motion].motion_modes[idof]</span>
        
        <span class="n">force_mod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_mapper</span><span class="o">.</span><span class="n">get_force_mode</span><span class="p">(</span><span class="n">ibody_force</span><span class="p">,</span> <span class="n">iforce</span><span class="p">)</span>
        <span class="n">motion_mod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_mapper</span><span class="o">.</span><span class="n">get_motion_mode</span><span class="p">(</span><span class="n">ibody_motion</span><span class="p">,</span> <span class="n">idof</span><span class="p">)</span>
    
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">force_mod</span><span class="p">,</span> <span class="n">ForceMode</span><span class="p">):</span>
            <span class="n">force_str</span> <span class="o">=</span> <span class="s1">&#39;force&#39;</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">motion_mod</span><span class="p">,</span> <span class="n">TranslationMode</span><span class="p">):</span>
                <span class="n">ylabel1</span> <span class="o">+=</span> <span class="sa">r</span><span class="s1">&#39; $(kg/s)$&#39;</span>
                <span class="n">ylabel2</span> <span class="o">+=</span> <span class="sa">r</span><span class="s1">&#39; $(kg)$&#39;</span>
                <span class="n">motion_str</span> <span class="o">=</span> <span class="s1">&#39;translation&#39;</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># Rotation</span>
                <span class="n">ylabel1</span> <span class="o">+=</span> <span class="sa">r</span><span class="s1">&#39; $(kg\,m/s)$&#39;</span>
                <span class="n">ylabel2</span> <span class="o">+=</span> <span class="sa">r</span><span class="s1">&#39; $(kg\,m)$&#39;</span>
                <span class="n">motion_str</span> <span class="o">=</span> <span class="s1">&#39;rotation&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">force_str</span> <span class="o">=</span> <span class="s1">&#39;moment&#39;</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">motion_mod</span><span class="p">,</span> <span class="n">TranslationMode</span><span class="p">):</span>
                <span class="n">ylabel1</span> <span class="o">+=</span> <span class="sa">r</span><span class="s1">&#39; $(kg\,m/s)$&#39;</span>
                <span class="n">ylabel2</span> <span class="o">+=</span> <span class="sa">r</span><span class="s1">&#39; $(kg\,m)$&#39;</span>
                <span class="n">motion_str</span> <span class="o">=</span> <span class="s1">&#39;translation&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ylabel1</span> <span class="o">+=</span> <span class="sa">r</span><span class="s1">&#39; $(kg\,m^2/s)$&#39;</span>
                <span class="n">ylabel2</span> <span class="o">+=</span> <span class="sa">r</span><span class="s1">&#39; $(kg\,m^2)$&#39;</span>
                <span class="n">motion_str</span> <span class="o">=</span> <span class="s1">&#39;rotation&#39;</span>
    
        <span class="n">title</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;Radiation coefficients giving </span><span class="si">%s</span><span class="s2"> on body </span><span class="si">%u</span><span class="s2"> along mode </span><span class="si">%u</span><span class="s2"> &quot;</span> \
                <span class="sa">r</span><span class="s2">&quot;for a </span><span class="si">%s</span><span class="s2"> motion of body </span><span class="si">%u</span><span class="s2"> along mode </span><span class="si">%u</span><span class="s2">&quot;</span> \
                <span class="o">%</span> <span class="p">(</span><span class="n">force_str</span><span class="p">,</span> <span class="n">ibody_force</span><span class="p">,</span> <span class="n">iforce</span><span class="p">,</span> <span class="n">motion_str</span><span class="p">,</span> <span class="n">ibody_motion</span><span class="p">,</span> <span class="n">idof</span><span class="p">)</span>
    
        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">omega</span>
    
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">ca</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel1</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">cm</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">has_cminf</span><span class="p">:</span>
            <span class="n">w_01</span> <span class="o">=</span> <span class="p">[</span><span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">w</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">cm_inf01</span> <span class="o">=</span> <span class="p">[</span><span class="n">cminf</span><span class="p">,</span> <span class="n">cminf</span><span class="p">]</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w_01</span><span class="p">,</span> <span class="n">cm_inf01</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel2</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_plot_radiation_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coeff</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generic method to plot an array of radiation coefficients</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        coeff : str</span>
<span class="sd">            Must be &#39;added_mass&#39; or &#39;damping&#39;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">coeff</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;added_mass&#39;</span><span class="p">,</span> <span class="s1">&#39;damping&#39;</span><span class="p">)</span>
    
        <span class="n">omega</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">omega</span>
        
        <span class="n">has_cminf</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">cminf</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">w_01</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="k">if</span> <span class="n">coeff</span> <span class="o">==</span> <span class="s1">&#39;added_mass&#39;</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">added_mass</span>
            <span class="n">suptitle</span> <span class="o">=</span> <span class="s2">&quot;Added mass array&quot;</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cm_inf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">has_cminf</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">cminf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infinite_added_mass</span>
                <span class="n">w_01</span> <span class="o">=</span> <span class="p">[</span><span class="n">omega</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">omega</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
            
            <span class="n">is_added_mass</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">radiation_damping</span>
            <span class="n">suptitle</span> <span class="o">=</span> <span class="s2">&quot;Radiation damping array&quot;</span>
            <span class="n">is_added_mass</span> <span class="o">=</span> <span class="kc">False</span>
    
        <span class="n">n_integration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_mapper</span><span class="o">.</span><span class="n">nb_force_modes</span>
        <span class="n">n_radiation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_mapper</span><span class="o">.</span><span class="n">nb_motion_modes</span>
    
        <span class="n">iplot</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">iforce_mod</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">n_integration</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">idof_mod</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">n_radiation</span><span class="p">):</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">n_integration</span><span class="p">,</span> <span class="n">n_radiation</span><span class="p">,</span> <span class="n">iplot</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">omega</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">iforce_mod</span><span class="p">,</span> <span class="p">:,</span> <span class="n">idof_mod</span><span class="p">])</span>
                
                <span class="k">if</span> <span class="n">iforce_mod</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Putting labels on the left</span>
                    <span class="n">ibody</span><span class="p">,</span> <span class="n">imod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_mapper</span><span class="o">.</span><span class="n">_motion_mod_dict</span><span class="p">[</span><span class="n">idof_mod</span><span class="p">]</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;(</span><span class="si">%u</span><span class="s1">, </span><span class="si">%u</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ibody</span><span class="p">,</span> <span class="n">imod</span><span class="p">))</span>
                
                <span class="k">if</span> <span class="n">idof_mod</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Putting labels on the top</span>
                    <span class="n">ibody</span><span class="p">,</span> <span class="n">imod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_mapper</span><span class="o">.</span><span class="n">_force_mod_dict</span><span class="p">[</span><span class="n">iforce_mod</span><span class="p">]</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;(</span><span class="si">%u</span><span class="s1">, </span><span class="si">%u</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ibody</span><span class="p">,</span> <span class="n">imod</span><span class="p">))</span>
            
                <span class="k">if</span> <span class="n">is_added_mass</span> <span class="ow">and</span> <span class="n">has_cminf</span><span class="p">:</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="n">cminf</span><span class="p">[</span><span class="n">iforce_mod</span><span class="p">,</span> <span class="n">idof_mod</span><span class="p">]</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w_01</span><span class="p">,</span> <span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">c</span><span class="p">])</span>
            
                <span class="n">iplot</span> <span class="o">+=</span> <span class="mi">1</span>
    
        <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">suptitle</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<div class="viewcode-block" id="RadiationDB.plot_added_mass_array"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.RadiationDB.plot_added_mass_array">[docs]</a>    <span class="k">def</span> <span class="nf">plot_added_mass_array</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plots the added mass coefficients in an array for every modes&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plot_radiation_array</span><span class="p">(</span><span class="s1">&#39;added_mass&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="RadiationDB.plot_radiation_damping_array"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.RadiationDB.plot_radiation_damping_array">[docs]</a>    <span class="k">def</span> <span class="nf">plot_radiation_damping_array</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plots the radiation damping coefficients in an array for every modes&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plot_radiation_array</span><span class="p">(</span><span class="s1">&#39;damping&#39;</span><span class="p">)</span></div></div>
    

<div class="viewcode-block" id="RadiationIRFDB"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.RadiationIRFDB">[docs]</a><span class="k">class</span> <span class="nc">RadiationIRFDB</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Class for dealing with impulse response functions.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># TODO: meme en cas d&#39;unique force et mouvement, data devrait de shape (1, 1, nt) !!</span>
    <span class="c1"># NOTE: data is of shape nb_forces x nb_motion x nb_time_samples</span>
    
    <span class="c1"># (nb_force_modes x nb_motion_modes x nb_time_irf)</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor of the class RadiationIRFDB.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_tf</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dt</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">body_mapper</span> <span class="o">=</span> <span class="n">HydroBodySetMapping</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>

<div class="viewcode-block" id="RadiationIRFDB.set_data"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.RadiationIRFDB.set_data">[docs]</a>    <span class="k">def</span> <span class="nf">set_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tf</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;This subroutine sets the data and temporal parameters of the impulse response functions.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tf : float</span>
<span class="sd">            Final time.</span>
<span class="sd">        dt : float</span>
<span class="sd">            Time step.</span>
<span class="sd">        data : Array of floats</span>
<span class="sd">            Array of impulse response functions.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_tf</span> <span class="o">=</span> <span class="n">tf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dt</span> <span class="o">=</span> <span class="n">dt</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">),</span> <span class="s2">&quot;Inconsistent number of sample in IRF&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">irf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;This subroutine gives the array of the impulse response functions.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Array of floats</span>
<span class="sd">            Array of impulse response functions.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tmax</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;This subroutine gives the final time to evaluate the impulse response functions.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Float</span>
<span class="sd">            Final time.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tf</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;This subroutine gives the time step to evaluate the impulse response functions.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Float</span>
<span class="sd">            Time step.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dt</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;This subroutine indicates if an array of impulse response functions is stored or not.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Bool</span>
<span class="sd">            True if some data are stored, false otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nb_force_modes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;This subroutine gives the number of force modes.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            Number of force modes.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nb_motion_modes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;This subroutine gives the number of motion modes.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            Number of motion modes.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nb_time_samples</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;This subroutine gives the size of the time vector used to evaluate the impulse response functions.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            Size of the temporal vector.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;This subroutine gives the time vector.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Array</span>
<span class="sd">            Time vector.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dt</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tf</span> <span class="o">+</span> <span class="n">dt</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">flags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span>

    <span class="nd">@flags</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">flags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flags</span><span class="p">):</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_mapper</span><span class="o">.</span><span class="n">nb_force_modes</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_mapper</span><span class="o">.</span><span class="n">nb_motion_modes</span>
        <span class="k">assert</span> <span class="n">flags</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span> <span class="o">=</span> <span class="n">flags</span>
    
<div class="viewcode-block" id="RadiationIRFDB.clean"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.RadiationIRFDB.clean">[docs]</a>    <span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">max_irf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    
        <span class="c1"># data = np.fabs(irf_db.data)</span>
        <span class="c1"># data = irf_db.data</span>
        <span class="c1"># integ = np.fabs(np.trapz(data, x=irf_db.time, axis=-1)**2)</span>
    
        <span class="c1"># plt.matshow(integ, cmap=plt.cm.inferno)</span>
        <span class="c1"># plt.show()</span>
    
        <span class="c1"># maxval = integ.max()</span>
        <span class="c1"># print integ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span><span class="p">[</span><span class="n">max_irf</span> <span class="o">&lt;</span> <span class="mf">1e4</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># TODO: les seuils doivent etre reglables</span></div>
    
<div class="viewcode-block" id="RadiationIRFDB.convolve"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.RadiationIRFDB.convolve">[docs]</a>    <span class="k">def</span> <span class="nf">convolve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">velocities</span><span class="p">):</span>
        <span class="c1"># TODO: verifier qu&#39;on envoie bien le bon nombre de vitesses</span>
        <span class="k">assert</span> <span class="n">velocities</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span>
            
        <span class="n">integrand</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ijk, jk -&gt; ijk&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">velocities</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">integrand</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_dt</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span></div>
    
<div class="viewcode-block" id="RadiationIRFDB.get_impulse_response_function"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.RadiationIRFDB.get_impulse_response_function">[docs]</a>    <span class="k">def</span> <span class="nf">get_impulse_response_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ibody_motion</span><span class="p">,</span> <span class="n">idof</span><span class="p">,</span> <span class="n">ibody_force</span><span class="p">,</span> <span class="n">iforce</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the impulse response function for a given modes set</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ibody_motion : int</span>
<span class="sd">            Index of the body having a motion</span>
<span class="sd">        idof : int</span>
<span class="sd">            Index of the local body&#39;s radiation mode (motion)</span>
<span class="sd">        ibody_force : int</span>
<span class="sd">            Index of the body where the radiation force is applied</span>
<span class="sd">        iforce : int</span>
<span class="sd">            Index of the local body&#39;s force mode</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.ndarray</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">idof_gal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_mapper</span><span class="o">.</span><span class="n">get_general_motion_index</span><span class="p">(</span><span class="n">ibody_motion</span><span class="p">,</span> <span class="n">idof</span><span class="p">)</span> <span class="c1"># gal = general index.</span>
        <span class="n">iforce_gal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_mapper</span><span class="o">.</span><span class="n">get_general_force_index</span><span class="p">(</span><span class="n">ibody_force</span><span class="p">,</span> <span class="n">iforce</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">iforce_gal</span><span class="p">,</span> <span class="n">idof_gal</span><span class="p">,</span> <span class="p">:]</span></div>

<div class="viewcode-block" id="RadiationIRFDB.get_impulse_response"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.RadiationIRFDB.get_impulse_response">[docs]</a>    <span class="k">def</span> <span class="nf">get_impulse_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ibody_force</span><span class="p">,</span> <span class="n">ibody_motion</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;This subroutine gives the impulse response functions for a body.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ibody_force : int</span>
<span class="sd">            Index of the body where the radiation force is applied</span>
<span class="sd">        ibody_motion : int</span>
<span class="sd">            Index of the body having a motion</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.ndarray</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">idof_start</span><span class="p">,</span> <span class="n">iforce_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_mapper</span><span class="o">.</span><span class="n">get_general_indexes</span><span class="p">(</span><span class="n">ibody_motion</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ibody_force</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">nb_force</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_mapper</span><span class="o">.</span><span class="n">get_body</span><span class="p">(</span><span class="n">ibody_force</span><span class="p">)</span><span class="o">.</span><span class="n">nb_force_modes</span>
        <span class="n">nb_dof</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_mapper</span><span class="o">.</span><span class="n">get_body</span><span class="p">(</span><span class="n">ibody_motion</span><span class="p">)</span><span class="o">.</span><span class="n">nb_dof</span>
        <span class="n">idof_end</span><span class="p">,</span> <span class="n">iforce_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_mapper</span><span class="o">.</span><span class="n">get_general_indexes</span><span class="p">(</span><span class="n">ibody_motion</span><span class="p">,</span> <span class="n">nb_dof</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">ibody_force</span><span class="p">,</span> <span class="n">nb_force</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">iforce_start</span><span class="p">:</span><span class="n">iforce_end</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">idof_start</span><span class="p">:</span><span class="n">idof_end</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span></div>



<div class="viewcode-block" id="RadiationIRFDB.plot"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.RadiationIRFDB.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ibody_motion</span><span class="p">,</span> <span class="n">idof</span><span class="p">,</span> <span class="n">ibody_force</span><span class="p">,</span> <span class="n">iforce</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plots the impulse response function of a given modes set</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ibody_motion : int</span>
<span class="sd">            Index of the body having a motion</span>
<span class="sd">        idof : int</span>
<span class="sd">            Index of the local body&#39;s raditation mode (motion)</span>
<span class="sd">        ibody_force : int</span>
<span class="sd">            Index of the body where the radiation force is applied</span>
<span class="sd">        iforce : int</span>
<span class="sd">            Index of the local body&#39;s force mode</span>
<span class="sd">        kwargs: optional</span>
<span class="sd">            Arguments that are to be used by pyplot</span>
<span class="sd">        &quot;&quot;&quot;</span>
    
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_impulse_response_function</span><span class="p">(</span><span class="n">ibody_motion</span><span class="p">,</span> <span class="n">idof</span><span class="p">,</span> <span class="n">ibody_force</span><span class="p">,</span> <span class="n">iforce</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$t (s)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$K(t)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>  <span class="c1"># TODO: mettre une unite</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Impulse response function of force </span><span class="si">%u</span><span class="s1"> on body </span><span class="si">%u</span><span class="s1"> for a motion </span><span class="si">%u</span><span class="s1"> of body </span><span class="si">%u</span><span class="s1">&#39;</span> <span class="o">%</span>
                  <span class="p">(</span><span class="n">iforce</span><span class="p">,</span> <span class="n">ibody_force</span><span class="p">,</span> <span class="n">idof</span><span class="p">,</span> <span class="n">ibody_motion</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>
        
<div class="viewcode-block" id="RadiationIRFDB.plot_array"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.RadiationIRFDB.plot_array">[docs]</a>    <span class="k">def</span> <span class="nf">plot_array</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plots the impulse response functions in an array for every modes&quot;&quot;&quot;</span>

        <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span>

        <span class="n">n_force</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_mapper</span><span class="o">.</span><span class="n">nb_force_modes</span>
        <span class="n">ndof</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_mapper</span><span class="o">.</span><span class="n">nb_motion_modes</span>

        <span class="n">iplot</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">iforce_mod</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">n_force</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">idof_mod</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">ndof</span><span class="p">):</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">n_force</span><span class="p">,</span> <span class="n">ndof</span><span class="p">,</span> <span class="n">iplot</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">iforce_mod</span><span class="p">,</span> <span class="n">idof_mod</span><span class="p">,</span> <span class="p">:])</span>
                <span class="n">iplot</span> <span class="o">+=</span> <span class="mi">1</span>
                
        <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Impulse response functions&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div></div>

    
<div class="viewcode-block" id="KochinFunction"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.KochinFunction">[docs]</a><span class="k">class</span> <span class="nc">KochinFunction</span><span class="p">(</span><span class="n">_FreqDB</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Class for dealing with Kochin functions.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor of the class KochinFunction.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">KochinFunction</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>
    
<div class="viewcode-block" id="HydroBody"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.HydroBody">[docs]</a><span class="k">class</span> <span class="nc">HydroBody</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class to represent a hydrodynamic body</span>
<span class="sd">    </span>
<span class="sd">    It is used to represent a hydrodynamic body that is used in BEM computations. This class is mainly here to</span>
<span class="sd">    enclose integration and radiation modes on a per body fashion.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ibody</span><span class="p">,</span> <span class="n">mesh</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor of the class HydroBody.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ibody</span> <span class="o">=</span> <span class="n">ibody</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span> <span class="o">=</span> <span class="n">mesh</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">motion_modes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">force_modes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_nds</span> <span class="o">=</span> <span class="kc">None</span>
    
<div class="viewcode-block" id="HydroBody.append_motion_mode"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.HydroBody.append_motion_mode">[docs]</a>    <span class="k">def</span> <span class="nf">append_motion_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">motion</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;This subroutine checks if the input is part of the classes TranslationMode or RotationMode.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        motion : Array</span>
<span class="sd">            Motion mode</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Bool</span>
<span class="sd">            True if the input is part of the classes TranslationMode or RotationMode, false otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">motion</span><span class="p">,</span> <span class="p">(</span><span class="n">TranslationMode</span><span class="p">,</span> <span class="n">RotationMode</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">motion_modes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">motion</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="HydroBody.append_force_mode"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.HydroBody.append_force_mode">[docs]</a>    <span class="k">def</span> <span class="nf">append_force_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;This subroutine checks if the input is part of the classes ForceMode or MomentMode.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        motion : Array</span>
<span class="sd">            Motion mode</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Bool</span>
<span class="sd">            True if the input is part of the classes ForceMode or MomentMode, false otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">force</span><span class="p">,</span> <span class="p">(</span><span class="n">ForceMode</span><span class="p">,</span> <span class="n">MomentMode</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">force_modes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">force</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="HydroBody.get_motion_mode"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.HydroBody.get_motion_mode">[docs]</a>    <span class="k">def</span> <span class="nf">get_motion_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idof</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the body&#39;s motion mode based on its index</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        idof : int</span>
<span class="sd">            Index of the mode inside the body&#39;s mode definition</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        TranslationMode, RotationMode</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">idof</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Motion mode for body </span><span class="si">%u</span><span class="s2"> must lie between 0 and </span><span class="si">%u</span><span class="s2">&quot;</span> \
                          <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ibody</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_dof</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion_modes</span><span class="p">[</span><span class="n">idof</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s1">&#39;Body </span><span class="si">%u</span><span class="s1"> has </span><span class="si">%u</span><span class="s1"> motion modes. Attempted to access to mode </span><span class="si">%u</span><span class="s1"> which is out of range&#39;</span>
                             <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ibody</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_dof</span><span class="p">,</span> <span class="n">idof</span><span class="p">))</span></div>
    
<div class="viewcode-block" id="HydroBody.get_force_mode"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.HydroBody.get_force_mode">[docs]</a>    <span class="k">def</span> <span class="nf">get_force_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the body&#39;s integration mode based on its index</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        i : int</span>
<span class="sd">            Index of the mode inside the body&#39;s mode definition</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        IntegrationModeForce, IntegrationModeMoment</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Force mode for body </span><span class="si">%u</span><span class="s2"> must lie between 0 and </span><span class="si">%u</span><span class="s2">&quot;</span> \
                       <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ibody</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_force_modes</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">force_modes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s1">&#39;Body </span><span class="si">%u</span><span class="s1"> has </span><span class="si">%u</span><span class="s1"> force modes. Attempted to access to mode </span><span class="si">%u</span><span class="s1"> which is out of range&#39;</span>
                             <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ibody</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_force_modes</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span></div>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nb_dof</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The total body&#39;s number of motion modes&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">motion_modes</span><span class="p">)</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nb_force_modes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The total body&#39;s number of force modes&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">force_modes</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_compute_nds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Computes the term n dS for each force mode of the body&quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_nds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nb_force_modes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">nb_faces</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
        
        <span class="n">areas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">faces_areas</span>
        <span class="n">normals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">faces_normals</span>
        <span class="n">centers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">faces_centers</span>
        
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">force_mode</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">force_modes</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">force_mode</span><span class="p">,</span> <span class="n">ForceMode</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_nds</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">areas</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij, j -&gt; i&#39;</span><span class="p">,</span> <span class="n">normals</span><span class="p">,</span> <span class="n">force_mode</span><span class="o">.</span><span class="n">direction</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># Moment</span>
                <span class="n">am</span> <span class="o">=</span> <span class="n">centers</span> <span class="o">-</span> <span class="n">force_mode</span><span class="o">.</span><span class="n">point</span>
                <span class="n">vel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">force_mode</span><span class="o">.</span><span class="n">direction</span><span class="p">,</span> <span class="n">am</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_nds</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">areas</span> <span class="o">*</span> <span class="p">(</span><span class="n">normals</span> <span class="o">*</span> <span class="n">vel</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
<div class="viewcode-block" id="HydroBody.get_nds"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.HydroBody.get_nds">[docs]</a>    <span class="k">def</span> <span class="nf">get_nds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iforce</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the array of ndS . direction vector for the specified force mode</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        iforce : int</span>
<span class="sd">            Force mode index</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.ndarray</span>
<span class="sd">            (n_faces) Array of ndS quantities</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_compute_nds</span><span class="p">()</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nds</span><span class="p">[</span><span class="n">iforce</span><span class="p">,</span> <span class="p">:]</span></div></div>
        
        
<span class="k">class</span> <span class="nc">_Mode</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class to define modes (motion or force).</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    direction : array_like</span>
<span class="sd">        3 component array of the mode direction</span>
<span class="sd">    point : array_like</span>
<span class="sd">        3 component array of the mode point</span>
<span class="sd">    general_index : int</span>
<span class="sd">        Index of the mode in the general structure</span>
<span class="sd">    ibody : int</span>
<span class="sd">        Index of the body that belongs that mode</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">general_index</span><span class="p">,</span> <span class="n">ibody</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot; Constructor of the class _Mode.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">direction</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">point</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">general_index</span> <span class="o">=</span> <span class="n">general_index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ibody</span> <span class="o">=</span> <span class="n">ibody</span>
        
        
<div class="viewcode-block" id="TranslationMode"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.TranslationMode">[docs]</a><span class="k">class</span> <span class="nc">TranslationMode</span><span class="p">(</span><span class="n">_Mode</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class representing a translation mode (radiation).&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">general_index</span><span class="p">,</span> <span class="n">ibody</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Constructor of the class TranslationMode.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">TranslationMode</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">direction</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">general_index</span><span class="p">,</span> <span class="n">ibody</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span>
        <span class="k">return</span> <span class="s2">&quot;Motion mode of body </span><span class="si">%u</span><span class="s2"> in translation (direction: </span><span class="si">%.3f</span><span class="s2">, </span><span class="si">%.3f</span><span class="s2">, </span><span class="si">%.3f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ibody</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span></div>
        
        
<div class="viewcode-block" id="RotationMode"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.RotationMode">[docs]</a><span class="k">class</span> <span class="nc">RotationMode</span><span class="p">(</span><span class="n">_Mode</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class representing a rotation mode (radiation).&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">general_index</span><span class="p">,</span> <span class="n">ibody</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot; Constructor of the class RotationMode.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">RotationMode</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">direction</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">general_index</span><span class="p">,</span> <span class="n">ibody</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">point</span>
        <span class="k">return</span> <span class="s2">&quot;Motion mode of body </span><span class="si">%u</span><span class="s2"> in rotation (direction: </span><span class="si">%.3f</span><span class="s2">, </span><span class="si">%.3f</span><span class="s2">, </span><span class="si">%.3f</span><span class="s2">, point: </span><span class="si">%.3f</span><span class="s2">, </span><span class="si">%.3f</span><span class="s2">, </span><span class="si">%.3f</span><span class="s2">)&quot;</span> <span class="o">%</span> \
               <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ibody</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span></div>


<div class="viewcode-block" id="ForceMode"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.ForceMode">[docs]</a><span class="k">class</span> <span class="nc">ForceMode</span><span class="p">(</span><span class="n">_Mode</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class representing a pure force mode.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">general_index</span><span class="p">,</span> <span class="n">ibody</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot; Constructor of the class ForceMode.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">ForceMode</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">direction</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">general_index</span><span class="p">,</span> <span class="n">ibody</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span>
        <span class="k">return</span> <span class="s2">&quot;Force mode of body </span><span class="si">%u</span><span class="s2"> in force (direction: </span><span class="si">%.3f</span><span class="s2">, </span><span class="si">%.3f</span><span class="s2">, </span><span class="si">%.3f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ibody</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span></div>


<div class="viewcode-block" id="MomentMode"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.MomentMode">[docs]</a><span class="k">class</span> <span class="nc">MomentMode</span><span class="p">(</span><span class="n">_Mode</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class representing a moment mode.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">general_index</span><span class="p">,</span> <span class="n">ibody</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot; Constructor of the class MomentMode.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">MomentMode</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">direction</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">general_index</span><span class="p">,</span> <span class="n">ibody</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">point</span>
        <span class="k">return</span> <span class="s2">&quot;Force mode of body </span><span class="si">%u</span><span class="s2"> in moment (direction: </span><span class="si">%.3f</span><span class="s2">, </span><span class="si">%.3f</span><span class="s2">, </span><span class="si">%.3f</span><span class="s2">, point: </span><span class="si">%.3f</span><span class="s2">, </span><span class="si">%.3f</span><span class="s2">, </span><span class="si">%.3f</span><span class="s2">)&quot;</span> <span class="o">%</span> \
               <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ibody</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span></div>


<div class="viewcode-block" id="UnknownMotionMode"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.UnknownMotionMode">[docs]</a><span class="k">class</span> <span class="nc">UnknownMotionMode</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Class representing an unknown motion mode (sic).&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">cal_file</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot; Constructor of the class UnknownMotionMode.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">i</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cal_file</span> <span class="o">=</span> <span class="n">cal_file</span>
        
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Unknown Motion Mode </span><span class="si">%u</span><span class="s2"> from Nemoh calculation file </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cal_file</span><span class="p">)</span></div>


<div class="viewcode-block" id="UnknownForceMode"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.UnknownForceMode">[docs]</a><span class="k">class</span> <span class="nc">UnknownForceMode</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Class representing an unknown force mode (sic).&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">cal_file</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot; Constructor of the class UnknownForceMode.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">i</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cal_file</span> <span class="o">=</span> <span class="n">cal_file</span>
        
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Unknown Force Mode </span><span class="si">%u</span><span class="s2"> from Nemoh calculation file </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cal_file</span><span class="p">)</span></div>
        

<div class="viewcode-block" id="HydroBodySetMapping"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.HydroBodySetMapping">[docs]</a><span class="k">class</span> <span class="nc">HydroBodySetMapping</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Class for dealing with hydrodynamic interactions.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor of the class HydroBodySetMapping.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bodies</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_motion_mod_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_force_mod_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    
<div class="viewcode-block" id="HydroBodySetMapping.append"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.HydroBodySetMapping.append">[docs]</a>    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">body</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;This subroutine adds a body.</span>

<span class="sd">        Parameter</span>
<span class="sd">        ----------</span>
<span class="sd">        HydroBody : body</span>
<span class="sd">            Hydrodynamic body.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="n">HydroBody</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bodies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">body</span><span class="p">)</span></div>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nb_bodies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;This subroutine gives the number of bodies.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            Number of bodies.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bodies</span><span class="p">)</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nb_motion_modes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Total number of radiation modes of the BEM computations (motion modes)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">body</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bodies</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">+=</span> <span class="n">body</span><span class="o">.</span><span class="n">nb_dof</span>
        <span class="k">return</span> <span class="n">n</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nb_force_modes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Total number of integration modes of the BEM computations (force modes)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">body</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bodies</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">+=</span> <span class="n">body</span><span class="o">.</span><span class="n">nb_force_modes</span>
        <span class="k">return</span> <span class="n">n</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">body</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;This subroutine gives all the bodies.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        HydroBody</span>
<span class="sd">            All the bodies.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bodies</span>

<div class="viewcode-block" id="HydroBodySetMapping.get_body"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.HydroBodySetMapping.get_body">[docs]</a>    <span class="k">def</span> <span class="nf">get_body</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ibody</span><span class="p">):</span>  <span class="c1"># TODO: Methode de HydroBodySetMapping</span>
        <span class="sd">&quot;&quot;&quot;Get the HydroBody object specified by its number.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ibody : int</span>
<span class="sd">            Index of the HydroBody</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        HydroBody</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">ibody</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Body index must be positive and currently lie between 0 and </span><span class="si">%u</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_bodies</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bodies</span><span class="p">[</span><span class="n">ibody</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s2">&quot;Current data contain only </span><span class="si">%u</span><span class="s2"> bodies. Attempted to access body number </span><span class="si">%u</span><span class="s2">&quot;</span>
                             <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nb_bodies</span><span class="p">,</span> <span class="n">ibody</span><span class="p">))</span></div>

<div class="viewcode-block" id="HydroBodySetMapping.get_general_motion_index"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.HydroBodySetMapping.get_general_motion_index">[docs]</a>    <span class="k">def</span> <span class="nf">get_general_motion_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ibody</span><span class="p">,</span> <span class="n">idof</span><span class="p">):</span>  <span class="c1"># TODO: Methode de HydroBodySetMapping</span>

        <span class="sd">&quot;&quot;&quot;This subroutine gives the general motion mode of a body.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ibody : int</span>
<span class="sd">            Index of the HydroBody.</span>
<span class="sd">        idof : int</span>
<span class="sd">            Index of the dof.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            Index of the motion mode in the general index.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bodies</span><span class="p">[</span><span class="n">ibody</span><span class="p">]</span><span class="o">.</span><span class="n">motion_modes</span><span class="p">[</span><span class="n">idof</span><span class="p">]</span><span class="o">.</span><span class="n">general_index</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s1">&#39;Body number or local motion id is out of range.&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="HydroBodySetMapping.get_general_force_index"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.HydroBodySetMapping.get_general_force_index">[docs]</a>    <span class="k">def</span> <span class="nf">get_general_force_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ibody</span><span class="p">,</span> <span class="n">iforce</span><span class="p">):</span>  <span class="c1"># TODO: Methode de HydroBodySetMapping</span>

        <span class="sd">&quot;&quot;&quot;This subroutine gives the general force mode of a body.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ibody : int</span>
<span class="sd">            Index of the HydroBody.</span>
<span class="sd">        iforce : int</span>
<span class="sd">            Force mode index.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            Index of the force mode in the general index.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bodies</span><span class="p">[</span><span class="n">ibody</span><span class="p">]</span><span class="o">.</span><span class="n">force_modes</span><span class="p">[</span><span class="n">iforce</span><span class="p">]</span><span class="o">.</span><span class="n">general_index</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s1">&#39;Body number or local force id is out of range.&#39;</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="HydroBodySetMapping.get_general_indexes"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.HydroBodySetMapping.get_general_indexes">[docs]</a>    <span class="k">def</span> <span class="nf">get_general_indexes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ibody_motion</span><span class="p">,</span> <span class="n">idof</span><span class="p">,</span> <span class="n">ibody_force</span><span class="p">,</span> <span class="n">iforce</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;This subroutine gives the general motion and force modes of a body.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ibody_motion : int</span>
<span class="sd">            Index of the body having a motion</span>
<span class="sd">        idof : int</span>
<span class="sd">            Index of the local body&#39;s raditation mode (motion)</span>
<span class="sd">        ibody_force : int</span>
<span class="sd">            Index of the body where the radiation force is applied</span>
<span class="sd">        iforce : int</span>
<span class="sd">            Index of the local body&#39;s force mode</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int : idof_gal</span>
<span class="sd">            Index of the motion mode in the general index.</span>
<span class="sd">        int : iforce_gal</span>
<span class="sd">            Index of the force mode in the general index.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">idof_gal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_general_motion_index</span><span class="p">(</span><span class="n">ibody_motion</span><span class="p">,</span> <span class="n">idof</span><span class="p">)</span>
        <span class="n">iforce_gal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_general_force_index</span><span class="p">(</span><span class="n">ibody_force</span><span class="p">,</span> <span class="n">iforce</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">idof_gal</span><span class="p">,</span> <span class="n">iforce_gal</span> <span class="c1"># gal = general index.</span></div>
    
<div class="viewcode-block" id="HydroBodySetMapping.get_force_mode"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.HydroBodySetMapping.get_force_mode">[docs]</a>    <span class="k">def</span> <span class="nf">get_force_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ibody</span><span class="p">,</span> <span class="n">iforce</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;This subroutine explains the general force mode of a body.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ibody : int</span>
<span class="sd">            Index of the HydroBody.</span>
<span class="sd">        iforce : int</span>
<span class="sd">            Force mode index.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        string</span>
<span class="sd">            Explanation about the force mode of the body.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bodies</span><span class="p">[</span><span class="n">ibody</span><span class="p">]</span><span class="o">.</span><span class="n">force_modes</span><span class="p">[</span><span class="n">iforce</span><span class="p">]</span></div>
    
<div class="viewcode-block" id="HydroBodySetMapping.get_motion_mode"><a class="viewcode-back" href="../../Source/Source_code_doc.html#HydroDB.hydro_db.HydroBodySetMapping.get_motion_mode">[docs]</a>    <span class="k">def</span> <span class="nf">get_motion_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ibody</span><span class="p">,</span> <span class="n">idof</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;This subroutine explains the general motion mode of a body.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ibody : int</span>
<span class="sd">            Index of the HydroBody.</span>
<span class="sd">        iforce : int</span>
<span class="sd">            Force mode index.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        string</span>
<span class="sd">            Explanation about the motion mode of the body.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bodies</span><span class="p">[</span><span class="n">ibody</span><span class="p">]</span><span class="o">.</span><span class="n">motion_modes</span><span class="p">[</span><span class="n">idof</span><span class="p">]</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, D-ICE Engineering

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
    

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>